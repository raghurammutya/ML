============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-7.4.3, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
metadata: {'Python': '3.12.3', 'Platform': 'Linux-6.8.0-64-generic-x86_64-with-glibc2.39', 'Packages': {'pytest': '7.4.3', 'pluggy': '1.6.0'}, 'Plugins': {'xdist': '3.8.0', 'Faker': '20.1.0', 'metadata': '3.1.1', 'html': '4.1.1', 'asyncio': '0.21.1', 'anyio': '3.7.1', 'cov': '4.1.0', 'mock': '3.12.0'}}
rootdir: /mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service
configfile: pytest.ini
plugins: xdist-3.8.0, Faker-20.1.0, metadata-3.1.1, html-4.1.1, asyncio-0.21.1, anyio-3.7.1, cov-4.1.0, mock-3.12.0
asyncio: mode=Mode.AUTO
collecting ... collected 252 items

tests/integration/test_api_endpoints.py::test_health_endpoint PASSED     [  0%]
tests/integration/test_api_endpoints.py::test_metrics_endpoint PASSED    [  0%]
tests/integration/test_api_endpoints.py::test_subscriptions_list FAILED  [  1%]
tests/integration/test_api_endpoints.py::test_subscriptions_pagination FAILED [  1%]
tests/integration/test_api_endpoints.py::test_invalid_pagination_params PASSED [  1%]
tests/integration/test_api_endpoints.py::test_mock_data_status SKIPPED   [  2%]
tests/integration/test_mock_cleanup.py::test_expired_cleanup_removes_old_options PASSED [  2%]
tests/integration/test_mock_cleanup.py::test_cleanup_handles_invalid_expiry_format PASSED [  3%]
tests/integration/test_mock_cleanup.py::test_cleanup_with_no_expiry PASSED [  3%]
tests/integration/test_mock_cleanup.py::test_cleanup_internal_vs_public PASSED [  3%]
tests/integration/test_mock_cleanup.py::test_cleanup_during_seed_operation PASSED [  4%]
tests/integration/test_refactored_components.py::test_mock_generator_integration PASSED [  4%]
tests/integration/test_refactored_components.py::test_subscription_reconciler_integration PASSED [  5%]
tests/integration/test_refactored_components.py::test_historical_bootstrapper_integration PASSED [  5%]
tests/integration/test_refactored_components.py::test_mock_generator_can_seed_underlying PASSED [  5%]
tests/integration/test_refactored_components.py::test_mock_generator_can_generate_underlying_bar PASSED [  6%]
tests/integration/test_refactored_components.py::test_mock_generator_can_seed_options PASSED [  6%]
tests/integration/test_refactored_components.py::test_mock_generator_can_generate_option_snapshot PASSED [  7%]
tests/integration/test_refactored_components.py::test_subscription_reconciler_can_build_assignments_with_empty_plan PASSED [  7%]
tests/integration/test_refactored_components.py::test_subscription_reconciler_can_build_assignments PASSED [  7%]
tests/integration/test_refactored_components.py::test_historical_bootstrapper_state_management PASSED [  8%]
tests/integration/test_refactored_components.py::test_all_services_reset_independently PASSED [  8%]
tests/integration/test_refactored_components.py::test_services_work_together_for_mock_data_flow PASSED [  9%]
tests/integration/test_refactored_components.py::test_dependency_injection_allows_custom_mock_generator PASSED [  9%]
tests/integration/test_tick_batcher.py::test_tick_batcher_accumulates_ticks PASSED [  9%]
tests/integration/test_tick_batcher.py::test_time_based_flushing PASSED  [ 10%]
tests/integration/test_tick_batcher.py::test_size_based_flushing PASSED  [ 10%]
tests/integration/test_tick_batcher.py::test_graceful_shutdown_flushes_remaining PASSED [ 11%]
tests/integration/test_tick_batcher.py::test_option_batching FAILED      [ 11%]
tests/integration/test_tick_batcher.py::test_disabled_batching_publishes_immediately PASSED [ 11%]
tests/integration/test_tick_batcher.py::test_batcher_stats PASSED        [ 12%]
tests/integration/test_tick_batcher.py::test_batch_fill_rate PASSED      [ 12%]
tests/integration/test_tick_batcher.py::test_mixed_underlying_and_options FAILED [ 13%]
tests/integration/test_tick_processor.py::test_tick_processor_integration PASSED [ 13%]
tests/integration/test_tick_processor.py::test_underlying_tick_processing FAILED [ 13%]
tests/integration/test_tick_processor.py::test_option_tick_processing FAILED [ 14%]
tests/integration/test_tick_processor.py::test_expired_contract_filtering PASSED [ 14%]
tests/integration/test_tick_processor.py::test_market_depth_extraction FAILED [ 15%]
tests/integration/test_tick_processor.py::test_tick_processor_state_management FAILED [ 15%]
tests/integration/test_tick_processor.py::test_dependency_injection_allows_custom_tick_processor PASSED [ 15%]
tests/integration/test_tick_processor.py::test_tick_processor_stats FAILED [ 16%]
tests/integration/test_websocket_basic.py::test_websocket_connection_established FAILED [ 16%]
tests/integration/test_websocket_basic.py::test_websocket_graceful_disconnect FAILED [ 17%]
tests/integration/test_websocket_basic.py::test_multiple_connections_isolated FAILED [ 17%]
tests/integration/test_websocket_basic.py::test_subscribe_to_instruments FAILED [ 17%]
tests/integration/test_websocket_basic.py::test_subscribe_idempotent FAILED [ 18%]
tests/integration/test_websocket_basic.py::test_unsubscribe_from_instruments FAILED [ 18%]
tests/integration/test_websocket_basic.py::test_subscription_filtering FAILED [ 19%]
tests/integration/test_websocket_basic.py::test_subscribe_nonexistent_connection PASSED [ 19%]
tests/integration/test_websocket_basic.py::test_unsubscribe_nonexistent_connection PASSED [ 19%]
tests/integration/test_websocket_basic.py::test_disconnect_nonexistent_connection PASSED [ 20%]
tests/integration/test_websocket_basic.py::test_connection_cleanup_removes_all_subscriptions FAILED [ 20%]
tests/integration/test_websocket_basic.py::test_multiple_subscribers_same_token FAILED [ 21%]
tests/integration/test_websocket_basic.py::test_partial_disconnect_preserves_other_subscribers FAILED [ 21%]
tests/load/test_tick_throughput.py::test_throughput_1000_instruments_baseline PASSED [ 21%]
tests/load/test_tick_throughput.py::test_throughput_5000_instruments_scale PASSED [ 22%]
tests/load/test_tick_throughput.py::test_burst_traffic PASSED            [ 22%]
tests/load/test_tick_throughput.py::test_sustained_load PASSED           [ 23%]
tests/load/test_tick_throughput.py::test_greeks_calculation_overhead PASSED [ 23%]
tests/unit/test_auth.py::test_verify_api_key_disabled PASSED             [ 23%]
tests/unit/test_auth.py::test_verify_api_key_missing PASSED              [ 24%]
tests/unit/test_auth.py::test_verify_api_key_invalid PASSED              [ 24%]
tests/unit/test_auth.py::test_verify_api_key_valid PASSED                [ 25%]
tests/unit/test_circuit_breaker.py::test_circuit_starts_closed PASSED    [ 25%]
tests/unit/test_circuit_breaker.py::test_circuit_opens_after_threshold PASSED [ 25%]
tests/unit/test_circuit_breaker.py::test_circuit_rejects_when_open PASSED [ 26%]
tests/unit/test_circuit_breaker.py::test_circuit_recovers_after_timeout PASSED [ 26%]
tests/unit/test_circuit_breaker.py::test_half_open_to_closed_on_success PASSED [ 26%]
tests/unit/test_circuit_breaker.py::test_half_open_to_open_on_failure PASSED [ 27%]
tests/unit/test_circuit_breaker.py::test_half_open_limits_attempts PASSED [ 27%]
tests/unit/test_circuit_breaker.py::test_success_resets_failure_count_in_closed PASSED [ 28%]
tests/unit/test_circuit_breaker.py::test_manual_reset PASSED             [ 28%]
tests/unit/test_circuit_breaker.py::test_concurrent_failure_recording PASSED [ 28%]
tests/unit/test_circuit_breaker.py::test_circuit_with_exception_info PASSED [ 29%]
tests/unit/test_circuit_breaker.py::test_multiple_recovery_cycles PASSED [ 29%]
tests/unit/test_config.py::test_settings_defaults PASSED                 [ 30%]
tests/unit/test_config.py::test_settings_api_key_validation PASSED       [ 30%]
tests/unit/test_config.py::test_settings_production_requires_auth PASSED [ 30%]
tests/unit/test_config.py::test_settings_positive_integers PASSED        [ 31%]
tests/unit/test_config.py::test_settings_port_validation PASSED          [ 31%]
tests/unit/test_config.py::test_settings_ticker_mode_validation PASSED   [ 32%]
tests/unit/test_greeks_calculator.py::test_time_to_expiry_same_day PASSED [ 32%]
tests/unit/test_greeks_calculator.py::test_time_to_expiry_future_date PASSED [ 32%]
tests/unit/test_greeks_calculator.py::test_time_to_expiry_expired_option PASSED [ 33%]
tests/unit/test_greeks_calculator.py::test_time_to_expiry_with_invalid_date_format PASSED [ 33%]
tests/unit/test_greeks_calculator.py::test_time_to_expiry_uses_current_time_if_not_provided PASSED [ 34%]
tests/unit/test_greeks_calculator.py::test_iv_calculation_atm_call SKIPPED [ 34%]
tests/unit/test_greeks_calculator.py::test_iv_zero_market_price_returns_zero SKIPPED [ 34%]
tests/unit/test_greeks_calculator.py::test_iv_zero_time_to_expiry_returns_zero SKIPPED [ 35%]
tests/unit/test_greeks_calculator.py::test_iv_bounds_validation SKIPPED  [ 35%]
tests/unit/test_greeks_calculator.py::test_iv_handles_option_type_variations SKIPPED [ 36%]
tests/unit/test_greeks_calculator.py::test_greeks_atm_call_delta_around_05 SKIPPED [ 36%]
tests/unit/test_greeks_calculator.py::test_greeks_deep_itm_call_delta_approaches_1 SKIPPED [ 36%]
tests/unit/test_greeks_calculator.py::test_greeks_deep_otm_call_delta_approaches_0 SKIPPED [ 37%]
tests/unit/test_greeks_calculator.py::test_greeks_gamma_peaks_at_atm SKIPPED [ 37%]
tests/unit/test_greeks_calculator.py::test_greeks_theta_negative_for_long_options SKIPPED [ 38%]
tests/unit/test_greeks_calculator.py::test_greeks_vega_positive_for_calls_and_puts SKIPPED [ 38%]
tests/unit/test_greeks_calculator.py::test_greeks_returns_all_five_greeks SKIPPED [ 38%]
tests/unit/test_greeks_calculator.py::test_greeks_at_expiry_itm_call SKIPPED [ 39%]
tests/unit/test_greeks_calculator.py::test_greeks_at_expiry_otm_call SKIPPED [ 39%]
tests/unit/test_greeks_calculator.py::test_greeks_invalid_spot_price_returns_zeros PASSED [ 40%]
tests/unit/test_greeks_calculator.py::test_greeks_invalid_volatility_returns_zeros PASSED [ 40%]
tests/unit/test_greeks_calculator.py::test_greeks_put_option_negative_delta SKIPPED [ 40%]
tests/unit/test_greeks_calculator.py::test_bs_greeks_and_values_call_pricing SKIPPED [ 41%]
tests/unit/test_greeks_calculator.py::test_bs_greeks_intrinsic_value_itm_call SKIPPED [ 41%]
tests/unit/test_greeks_calculator.py::test_bs_greeks_intrinsic_value_itm_put SKIPPED [ 42%]
tests/unit/test_greeks_calculator.py::test_bs_greeks_extrinsic_value_with_option_price SKIPPED [ 42%]
tests/unit/test_greeks_calculator.py::test_bs_greeks_theta_daily_conversion SKIPPED [ 42%]
tests/unit/test_greeks_calculator.py::test_bs_greeks_rho_per_1pct_conversion SKIPPED [ 43%]
tests/unit/test_greeks_calculator.py::test_bs_greeks_at_expiry SKIPPED   [ 43%]
tests/unit/test_greeks_calculator.py::test_bsm_greeks_with_dividend_yield SKIPPED [ 44%]
tests/unit/test_greeks_calculator.py::test_calculate_option_greeks_complete_workflow SKIPPED [ 44%]
tests/unit/test_greeks_calculator.py::test_calculator_initialization_with_defaults PASSED [ 44%]
tests/unit/test_greeks_calculator.py::test_calculator_invalid_timezone_falls_back_to_utc PASSED [ 45%]
tests/unit/test_greeks_calculator.py::test_greeks_without_vollib_returns_zeros PASSED [ 45%]
tests/unit/test_mock_state_concurrency.py::test_mock_underlying_snapshots_are_immutable PASSED [ 46%]
tests/unit/test_mock_state_concurrency.py::test_mock_option_snapshots_are_immutable PASSED [ 46%]
tests/unit/test_mock_state_concurrency.py::test_mock_underlying_concurrent_reads PASSED [ 46%]
tests/unit/test_mock_state_concurrency.py::test_mock_option_concurrent_reads PASSED [ 47%]
tests/unit/test_mock_state_concurrency.py::test_mock_underlying_no_double_initialization PASSED [ 47%]
tests/unit/test_mock_state_concurrency.py::test_builder_mutation_only_under_lock PASSED [ 48%]
tests/unit/test_mock_state_concurrency.py::test_snapshot_updates_are_atomic PASSED [ 48%]
tests/unit/test_mock_state_concurrency.py::test_reset_mock_state_clears_all PASSED [ 48%]
tests/unit/test_mock_state_eviction.py::test_lru_eviction_enforces_max_size PASSED [ 49%]
tests/unit/test_mock_state_eviction.py::test_lru_eviction_maintains_order PASSED [ 49%]
tests/unit/test_mock_state_eviction.py::test_empty_state_no_eviction PASSED [ 50%]
tests/unit/test_mock_state_eviction.py::test_eviction_with_concurrent_access PASSED [ 50%]
tests/unit/test_mock_state_eviction.py::test_max_size_configuration PASSED [ 50%]
tests/unit/test_order_executor.py::test_submit_order_success PASSED      [ 51%]
tests/unit/test_order_executor.py::test_circuit_breaker_allows_normal_operation PASSED [ 51%]
tests/unit/test_order_executor.py::test_task_status_tracking PASSED      [ 51%]
tests/unit/test_order_executor.py::test_circuit_breaker_opens_after_threshold PASSED [ 52%]
tests/unit/test_order_executor.py::test_circuit_breaker_recovers_to_closed FAILED [ 52%]
tests/unit/test_order_executor.py::test_task_cleanup_on_max_capacity FAILED [ 53%]
tests/unit/test_order_executor.py::test_idempotency_prevents_duplicate_submission FAILED [ 53%]
tests/unit/test_order_executor.py::test_task_retry_with_exponential_backoff PASSED [ 53%]
tests/unit/test_order_executor.py::test_concurrent_task_submission FAILED [ 54%]
tests/unit/test_order_executor.py::test_task_dict_to_dict_serialization PASSED [ 54%]
tests/unit/test_order_executor.py::test_get_task_status FAILED           [ 55%]
tests/unit/test_order_executor.py::test_list_tasks FAILED                [ 55%]
tests/unit/test_order_executor_TEMPLATE.py::test_place_order_success ERROR [ 55%]
tests/unit/test_order_executor_TEMPLATE.py::test_place_order_network_error_retry ERROR [ 56%]
tests/unit/test_order_executor_TEMPLATE.py::test_place_order_max_retries_exceeded ERROR [ 56%]
tests/unit/test_order_executor_TEMPLATE.py::test_modify_order_idempotency ERROR [ 57%]
tests/unit/test_order_executor_TEMPLATE.py::test_cancel_order_success ERROR [ 57%]
tests/unit/test_order_executor_TEMPLATE.py::test_circuit_breaker_opens_after_failures ERROR [ 57%]
tests/unit/test_order_executor_TEMPLATE.py::test_circuit_breaker_rejects_when_open ERROR [ 58%]
tests/unit/test_order_executor_TEMPLATE.py::test_circuit_breaker_half_open_recovery ERROR [ 58%]
tests/unit/test_order_executor_TEMPLATE.py::test_circuit_breaker_reopen_on_half_open_failure ERROR [ 59%]
tests/unit/test_order_executor_TEMPLATE.py::test_circuit_breaker_manual_reset ERROR [ 59%]
tests/unit/test_order_executor_TEMPLATE.py::test_concurrent_task_execution ERROR [ 59%]
tests/unit/test_order_executor_TEMPLATE.py::test_task_status_transitions ERROR [ 60%]
tests/unit/test_order_executor_TEMPLATE.py::test_exponential_backoff ERROR [ 60%]
tests/unit/test_order_executor_TEMPLATE.py::test_dead_letter_queue_handling ERROR [ 61%]
tests/unit/test_order_executor_TEMPLATE.py::test_task_persistence ERROR  [ 61%]
tests/unit/test_order_executor_TEMPLATE.py::test_invalid_operation_raises_error ERROR [ 61%]
tests/unit/test_order_executor_TEMPLATE.py::test_missing_params_raises_error ERROR [ 62%]
tests/unit/test_order_executor_TEMPLATE.py::test_task_timeout ERROR      [ 62%]
tests/unit/test_order_executor_TEMPLATE.py::test_executor_cleanup ERROR  [ 63%]
tests/unit/test_order_executor_TEMPLATE.py::test_executor_stats ERROR    [ 63%]
tests/unit/test_order_executor_TEMPLATE.py::test_kite_api_input_exception_no_retry ERROR [ 63%]
tests/unit/test_order_executor_TEMPLATE.py::test_order_already_placed_idempotency ERROR [ 64%]
tests/unit/test_order_executor_simple.py::test_submit_task_creates_pending_task PASSED [ 64%]
tests/unit/test_order_executor_simple.py::test_idempotency_same_params_returns_same_task PASSED [ 65%]
tests/unit/test_order_executor_simple.py::test_get_task_returns_existing_task PASSED [ 65%]
tests/unit/test_order_executor_simple.py::test_get_all_tasks_returns_list FAILED [ 65%]
tests/unit/test_order_executor_simple.py::test_get_all_tasks_with_status_filter FAILED [ 66%]
tests/unit/test_order_executor_simple.py::test_circuit_breaker_closed_initially PASSED [ 66%]
tests/unit/test_order_executor_simple.py::test_circuit_breaker_opens_on_failures PASSED [ 67%]
tests/unit/test_order_executor_simple.py::test_circuit_breaker_transitions_to_half_open PASSED [ 67%]
tests/unit/test_order_executor_simple.py::test_task_to_dict_serialization PASSED [ 67%]
tests/unit/test_order_executor_simple.py::test_generate_idempotency_key_deterministic PASSED [ 68%]
tests/unit/test_order_executor_simple.py::test_generate_idempotency_key_different_for_different_symbols FAILED [ 68%]
tests/unit/test_runtime_state.py::test_runtime_state_default PASSED      [ 69%]
tests/unit/test_runtime_state.py::test_set_mock_data_enabled PASSED      [ 69%]
tests/unit/test_runtime_state.py::test_runtime_state_thread_safety PASSED [ 69%]
tests/unit/test_runtime_state.py::test_get_state_summary PASSED          [ 70%]
tests/unit/test_security_fixes.py::TestSECCRITICAL001_TimingAttack::test_timing_attack_resistance PASSED [ 70%]
tests/unit/test_security_fixes.py::TestSECCRITICAL001_TimingAttack::test_invalid_key_rejection_constant_time SKIPPED [ 71%]
tests/unit/test_security_fixes.py::TestSECCRITICAL002_JWKS_SSRF::test_https_only_enforcement PASSED [ 71%]
tests/unit/test_security_fixes.py::TestSECCRITICAL002_JWKS_SSRF::test_private_ip_blocking PASSED [ 71%]
tests/unit/test_security_fixes.py::TestSECCRITICAL002_JWKS_SSRF::test_domain_whitelist_enforcement PASSED [ 72%]
tests/unit/test_security_fixes.py::TestSECCRITICAL002_JWKS_SSRF::test_redirect_prevention PASSED [ 72%]
tests/unit/test_security_fixes.py::TestSECCRITICAL003_CleartextCredentials::test_encryption_required PASSED [ 73%]
tests/unit/test_security_fixes.py::TestSECCRITICAL003_CleartextCredentials::test_token_encryption_and_permissions PASSED [ 73%]
tests/unit/test_security_fixes.py::TestSECCRITICAL003_CleartextCredentials::test_plaintext_migration PASSED [ 73%]
tests/unit/test_security_fixes.py::TestSECCRITICAL004_WeakEncryption::test_encryption_key_required PASSED [ 74%]
tests/unit/test_security_fixes.py::TestSECCRITICAL004_WeakEncryption::test_no_key_logging PASSED [ 74%]
tests/unit/test_security_fixes.py::TestSECCRITICAL004_WeakEncryption::test_key_validation PASSED [ 75%]
tests/unit/test_security_fixes.py::TestSECCRITICAL004_WeakEncryption::test_encryption_decryption_works PASSED [ 75%]
tests/unit/test_security_fixes.py::TestSecurityRegressionPrevention::test_no_hardcoded_secrets PASSED [ 75%]
tests/unit/test_security_fixes.py::TestSecurityRegressionPrevention::test_imports_present PASSED [ 76%]
tests/unit/test_subscription_reloader.py::test_reloader_coalesces_requests PASSED [ 76%]
tests/unit/test_subscription_reloader.py::test_reloader_rate_limiting PASSED [ 76%]
tests/unit/test_subscription_reloader.py::test_reloader_debouncing PASSED [ 77%]
tests/unit/test_subscription_reloader.py::test_reloader_handles_reload_failure PASSED [ 77%]
tests/unit/test_subscription_reloader.py::test_reloader_semaphore_ensures_single_reload PASSED [ 78%]
tests/unit/test_subscription_reloader.py::test_reloader_start_stop PASSED [ 78%]
tests/unit/test_subscription_reloader.py::test_reloader_warning_on_double_start PASSED [ 78%]
tests/unit/test_task_monitor.py::test_task_monitor_captures_exception PASSED [ 79%]
tests/unit/test_task_monitor.py::test_task_monitor_successful_task PASSED [ 79%]
tests/unit/test_task_monitor.py::test_task_monitor_with_error_callback PASSED [ 80%]
tests/unit/test_task_monitor.py::test_task_monitor_with_async_error_callback PASSED [ 80%]
tests/unit/test_task_monitor.py::test_task_monitor_cancelled_task PASSED [ 80%]
tests/unit/test_task_monitor.py::test_task_monitor_multiple_tasks PASSED [ 81%]
tests/unit/test_task_monitor.py::test_task_monitor_error_in_callback PASSED [ 81%]
tests/unit/test_tick_metrics.py::test_all_metrics_registered PASSED      [ 82%]
tests/unit/test_tick_metrics.py::test_record_tick_processing PASSED      [ 82%]
tests/unit/test_tick_metrics.py::test_record_greeks_calculation PASSED   [ 82%]
tests/unit/test_tick_metrics.py::test_record_batch_flush PASSED          [ 83%]
tests/unit/test_tick_metrics.py::test_record_tick_published PASSED       [ 83%]
tests/unit/test_tick_metrics.py::test_record_processing_error PASSED     [ 84%]
tests/unit/test_tick_metrics.py::test_record_validation_error PASSED     [ 84%]
tests/unit/test_tick_metrics.py::test_update_batch_fill_rate PASSED      [ 84%]
tests/unit/test_tick_metrics.py::test_update_pending_batch_size PASSED   [ 85%]
tests/unit/test_tick_metrics.py::test_update_underlying_price PASSED     [ 85%]
tests/unit/test_tick_metrics.py::test_set_active_accounts PASSED         [ 86%]
tests/unit/test_tick_metrics.py::test_histogram_buckets PASSED           [ 86%]
tests/unit/test_tick_metrics.py::test_metric_labels PASSED               [ 86%]
tests/unit/test_tick_validator.py::TestUnderlyingTickSchema::test_valid_underlying_tick PASSED [ 87%]
tests/unit/test_tick_validator.py::TestUnderlyingTickSchema::test_minimal_valid_tick PASSED [ 87%]
tests/unit/test_tick_validator.py::TestUnderlyingTickSchema::test_negative_instrument_token PASSED [ 88%]
tests/unit/test_tick_validator.py::TestUnderlyingTickSchema::test_zero_instrument_token PASSED [ 88%]
tests/unit/test_tick_validator.py::TestUnderlyingTickSchema::test_zero_price PASSED [ 88%]
tests/unit/test_tick_validator.py::TestUnderlyingTickSchema::test_negative_price PASSED [ 89%]
tests/unit/test_tick_validator.py::TestUnderlyingTickSchema::test_unreasonably_high_price PASSED [ 89%]
tests/unit/test_tick_validator.py::TestUnderlyingTickSchema::test_negative_volume PASSED [ 90%]
tests/unit/test_tick_validator.py::TestUnderlyingTickSchema::test_extra_fields_allowed PASSED [ 90%]
tests/unit/test_tick_validator.py::TestOptionTickSchema::test_valid_option_tick PASSED [ 90%]
tests/unit/test_tick_validator.py::TestOptionTickSchema::test_zero_option_price_allowed PASSED [ 91%]
tests/unit/test_tick_validator.py::TestOptionTickSchema::test_negative_option_price PASSED [ 91%]
tests/unit/test_tick_validator.py::TestOptionTickSchema::test_unreasonably_high_option_price PASSED [ 92%]
tests/unit/test_tick_validator.py::TestOptionTickSchema::test_negative_oi PASSED [ 92%]
tests/unit/test_tick_validator.py::TestTickValidator::test_validator_initialization PASSED [ 92%]
tests/unit/test_tick_validator.py::TestTickValidator::test_validator_disabled PASSED [ 93%]
tests/unit/test_tick_validator.py::TestTickValidator::test_validate_valid_underlying_tick PASSED [ 93%]
tests/unit/test_tick_validator.py::TestTickValidator::test_validate_invalid_underlying_tick PASSED [ 94%]
tests/unit/test_tick_validator.py::TestTickValidator::test_validate_invalid_underlying_tick_strict PASSED [ 94%]
tests/unit/test_tick_validator.py::TestTickValidator::test_validate_valid_option_tick PASSED [ 94%]
tests/unit/test_tick_validator.py::TestTickValidator::test_validate_invalid_option_tick PASSED [ 95%]
tests/unit/test_tick_validator.py::TestTickValidator::test_validate_option_tick_business_rule_violation PASSED [ 95%]
tests/unit/test_tick_validator.py::TestTickValidator::test_validate_option_tick_business_rule_strict PASSED [ 96%]
tests/unit/test_tick_validator.py::TestTickValidator::test_validate_batch_underlying PASSED [ 96%]
tests/unit/test_tick_validator.py::TestTickValidator::test_validate_batch_options PASSED [ 96%]
tests/unit/test_tick_validator.py::TestTickValidator::test_validate_batch_disabled PASSED [ 97%]
tests/unit/test_tick_validator.py::TestTickValidator::test_validate_batch_unknown_type PASSED [ 97%]
tests/unit/test_tick_validator.py::TestTickValidator::test_clear_errors PASSED [ 98%]
tests/unit/test_tick_validator.py::TestTickValidator::test_get_stats PASSED [ 98%]
tests/unit/test_tick_validator.py::TestTickValidator::test_field_mapping_volume_traded_today PASSED [ 98%]
tests/unit/test_tick_validator.py::TestTickValidator::test_field_mapping_volume PASSED [ 99%]
tests/unit/test_tick_validator.py::TestTickValidator::test_field_mapping_open_interest PASSED [ 99%]
tests/unit/test_tick_validator.py::TestTickValidator::test_missing_required_fields PASSED [100%]

==================================== ERRORS ====================================
__________________ ERROR at setup of test_place_order_success __________________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
____________ ERROR at setup of test_place_order_network_error_retry ____________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
___________ ERROR at setup of test_place_order_max_retries_exceeded ____________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
_______________ ERROR at setup of test_modify_order_idempotency ________________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
_________________ ERROR at setup of test_cancel_order_success __________________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
_________ ERROR at setup of test_circuit_breaker_opens_after_failures __________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
___________ ERROR at setup of test_circuit_breaker_rejects_when_open ___________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
__________ ERROR at setup of test_circuit_breaker_half_open_recovery ___________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
______ ERROR at setup of test_circuit_breaker_reopen_on_half_open_failure ______
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
_____________ ERROR at setup of test_circuit_breaker_manual_reset ______________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
_______________ ERROR at setup of test_concurrent_task_execution _______________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
________________ ERROR at setup of test_task_status_transitions ________________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
__________________ ERROR at setup of test_exponential_backoff __________________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
______________ ERROR at setup of test_dead_letter_queue_handling _______________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
___________________ ERROR at setup of test_task_persistence ____________________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
____________ ERROR at setup of test_invalid_operation_raises_error _____________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
______________ ERROR at setup of test_missing_params_raises_error ______________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
_____________________ ERROR at setup of test_task_timeout ______________________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
___________________ ERROR at setup of test_executor_cleanup ____________________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
____________________ ERROR at setup of test_executor_stats _____________________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
___________ ERROR at setup of test_kite_api_input_exception_no_retry ___________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
___________ ERROR at setup of test_order_already_placed_idempotency ____________
tests/unit/test_order_executor_TEMPLATE.py:29: in executor
    return OrderExecutor(
E   TypeError: OrderExecutor.__init__() got an unexpected keyword argument 'max_workers'
=================================== FAILURES ===================================
___________________________ test_subscriptions_list ____________________________
tests/integration/test_api_endpoints.py:32: in test_subscriptions_list
    response = client.get("/subscriptions")
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/testclient.py:499: in get
    return super().get(
/home/stocksadmin/.local/lib/python3.12/site-packages/httpx/_client.py:1041: in get
    return self.request(
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/testclient.py:465: in request
    return super().request(
/home/stocksadmin/.local/lib/python3.12/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/home/stocksadmin/.local/lib/python3.12/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/home/stocksadmin/.local/lib/python3.12/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/home/stocksadmin/.local/lib/python3.12/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/home/stocksadmin/.local/lib/python3.12/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/testclient.py:342: in handle_request
    raise exc
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/testclient.py:339: in handle_request
    portal.call(self.app, scope, receive, send)
/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/lib/python3.12/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/errors.py:184: in __call__
    raise exc
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/errors.py:162: in __call__
    await self.app(scope, receive, _send)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware.py:57: in dispatch
    response = await call_next(request)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py:84: in call_next
    raise app_exc
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py:70: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware.py:149: in dispatch
    return await call_next(request)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py:84: in call_next
    raise app_exc
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py:70: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__
    await self.app(scope, receive, send)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:79: in __call__
    raise exc
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:68: in __call__
    await self.app(scope, receive, sender)
/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:20: in __call__
    raise e
/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:17: in __call__
    await self.app(scope, receive, send)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py:718: in __call__
    await route.handle(scope, receive, send)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py:276: in handle
    await self.app(scope, receive, send)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py:66: in app
    response = await func(request)
/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/routing.py:274: in app
    raw_response = await run_endpoint_function(
/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function
    return await dependant.call(**values)
/home/stocksadmin/.local/lib/python3.12/site-packages/slowapi/extension.py:734: in async_wrapper
    response = await func(*args, **kwargs)  # type: ignore
app/main.py:738: in list_subscriptions
    records = await subscription_store.list_all()
app/subscription_store.py:157: in list_all
    return await self._fetch()
app/subscription_store.py:164: in _fetch
    await self.initialise()
app/subscription_store.py:47: in initialise
    await self._ensure_schema()
app/subscription_store.py:206: in _ensure_schema
    async with self._pool.connection() as conn:
/usr/lib/python3.12/contextlib.py:210: in __aenter__
    return await anext(self.gen)
/home/stocksadmin/.local/lib/python3.12/site-packages/psycopg_pool/pool_async.py:194: in connection
    conn = await self.getconn(timeout=timeout)
/home/stocksadmin/.local/lib/python3.12/site-packages/psycopg_pool/pool_async.py:229: in getconn
    raise PoolTimeout(
E   psycopg_pool.PoolTimeout: couldn't get a connection after 10.00 sec
----------------------------- Captured stdout call -----------------------------
[32m2025-11-09 06:34:30.625[0m | [1mINFO    [0m | [36mapp.middleware[0m:[36mdispatch[0m:[36m45[0m - [1mRequest started: GET /subscriptions[0m
[32m2025-11-09 06:34:40.632[0m | [31m[1mERROR   [0m | [36mapp.middleware[0m:[36mdispatch[0m:[36m77[0m - [31m[1mRequest failed: GET /subscriptions[0m
[33m[1mTraceback (most recent call last):[0m

  File "/usr/lib/python3.12/threading.py", line 1030, in _bootstrap
    self._bootstrap_inner()
    â”‚    â”” <function Thread._bootstrap_inner at 0x74172efaaf20>
    â”” <Thread(ThreadPoolExecutor-2_0, started 127642788325056)>
  File "/usr/lib/python3.12/threading.py", line 1073, in _bootstrap_inner
    self.run()
    â”‚    â”” <function Thread.run at 0x74172efaac00>
    â”” <Thread(ThreadPoolExecutor-2_0, started 127642788325056)>
  File "/usr/lib/python3.12/threading.py", line 1010, in run
    self._target(*self._args, **self._kwargs)
    â”‚    â”‚        â”‚    â”‚        â”‚    â”” {}
    â”‚    â”‚        â”‚    â”‚        â”” <Thread(ThreadPoolExecutor-2_0, started 127642788325056)>
    â”‚    â”‚        â”‚    â”” (<weakref at 0x7417271ddda0; to 'ThreadPoolExecutor' at 0x741727195400>, <_queue.SimpleQueue object at 0x7417271c52b0>, None,...
    â”‚    â”‚        â”” <Thread(ThreadPoolExecutor-2_0, started 127642788325056)>
    â”‚    â”” <function _worker at 0x74172d709ee0>
    â”” <Thread(ThreadPoolExecutor-2_0, started 127642788325056)>
  File "/usr/lib/python3.12/concurrent/futures/thread.py", line 92, in _worker
    work_item.run()
    â”‚         â”” <function _WorkItem.run at 0x74172d70a020>
    â”” <concurrent.futures.thread._WorkItem object at 0x7417271952e0>
  File "/usr/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             â”‚    â”‚   â”‚    â”‚       â”‚    â”” {'backend': 'asyncio', 'backend_options': {}}
             â”‚    â”‚   â”‚    â”‚       â”” <concurrent.futures.thread._WorkItem object at 0x7417271952e0>
             â”‚    â”‚   â”‚    â”” (<function start_blocking_portal.<locals>.run_portal at 0x74172716f4c0>,)
             â”‚    â”‚   â”” <concurrent.futures.thread._WorkItem object at 0x7417271952e0>
             â”‚    â”” <function run at 0x74172d69b4c0>
             â”” <concurrent.futures.thread._WorkItem object at 0x7417271952e0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/_core/_eventloop.py", line 68, in run
    return asynclib.run(func, *args, **backend_options)
           â”‚        â”‚   â”‚      â”‚       â”” {}
           â”‚        â”‚   â”‚      â”” ()
           â”‚        â”‚   â”” <function start_blocking_portal.<locals>.run_portal at 0x74172716f4c0>
           â”‚        â”” <function run at 0x741727228c20>
           â”” <module 'anyio._backends._asyncio' from '/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/_backends/_asyncio.py'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 204, in run
    return native_run(wrapper(), debug=debug)
           â”‚          â”‚                â”” False
           â”‚          â”” <function start_blocking_portal.<locals>.run_portal at 0x74172716f560>
           â”” <function run at 0x74172d7d3ba0>
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           â”‚      â”‚   â”” <coroutine object start_blocking_portal.<locals>.run_portal at 0x74172710f6a0>
           â”‚      â”” <function Runner.run at 0x74172d835580>
           â”” <asyncio.runners.Runner object at 0x741727195520>
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           â”‚    â”‚     â”‚                  â”” <Task pending name='anyio.from_thread.start_blocking_portal.<locals>.run_portal' coro=<start_blocking_portal.<locals>.run_por...
           â”‚    â”‚     â”” <function BaseEventLoop.run_until_complete at 0x74172d82b1a0>
           â”‚    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
           â”” <asyncio.runners.Runner object at 0x741727195520>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    â”‚    â”” <function BaseEventLoop.run_forever at 0x74172d82b100>
    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    â”‚    â”” <function BaseEventLoop._run_once at 0x74172d834f40>
    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
    â”‚      â”” <function Handle._run at 0x74172d7c1260>
    â”” <Handle <_asyncio.TaskStepMethWrapper object at 0x741727196a70>()>
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    â”‚    â”‚            â”‚    â”‚           â”‚    â”” <member '_args' of 'Handle' objects>
    â”‚    â”‚            â”‚    â”‚           â”” <Handle <_asyncio.TaskStepMethWrapper object at 0x741727196a70>()>
    â”‚    â”‚            â”‚    â”” <member '_callback' of 'Handle' objects>
    â”‚    â”‚            â”” <Handle <_asyncio.TaskStepMethWrapper object at 0x741727196a70>()>
    â”‚    â”” <member '_context' of 'Handle' objects>
    â”” <Handle <_asyncio.TaskStepMethWrapper object at 0x741727196a70>()>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/from_thread.py", line 217, in _call_func
    retval = await retval
                   â”” <coroutine object FastAPI.__call__ at 0x7417271b0310>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           â”‚      â”‚        â”” <function _TestClientTransport.handle_request.<locals>.send at 0x74172716e160>
                           â”‚      â”” <function _TestClientTransport.handle_request.<locals>.receive at 0x74172716f420>
                           â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          â”‚    â”‚                â”‚      â”‚        â”” <function _TestClientTransport.handle_request.<locals>.send at 0x74172716e160>
          â”‚    â”‚                â”‚      â”” <function _TestClientTransport.handle_request.<locals>.receive at 0x74172716f420>
          â”‚    â”‚                â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <starlette.middleware.errors.ServerErrorMiddleware object at 0x741727b1c2c0>
          â”” <fastapi.applications.FastAPI object at 0x741727b89e50>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          â”‚    â”‚   â”‚      â”‚        â”” <function ServerErrorMiddleware.__call__.<locals>._send at 0x74172716fc40>
          â”‚    â”‚   â”‚      â”” <function _TestClientTransport.handle_request.<locals>.receive at 0x74172716f420>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>
          â”” <starlette.middleware.errors.ServerErrorMiddleware object at 0x741727b1c2c0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     â”‚    â”‚             â”‚        â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x74172716d9e0>
                     â”‚    â”‚             â”” <starlette.requests.Request object at 0x741727196300>
                     â”‚    â”” <bound method RequestIDMiddleware.dispatch of <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>>
                     â”” <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>

> File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1mmiddleware.py[0m", line [33m57[0m, in [35mdispatch[0m
    [1mresponse[0m [35m[1m=[0m [35m[1mawait[0m [1mcall_next[0m[1m([0m[1mrequest[0m[1m)[0m
    [36m                 â”‚         â”” [0m[36m[1m<starlette.requests.Request object at 0x741727196300>[0m
    [36m                 â”” [0m[36m[1m<function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x74172716d9e0>[0m

  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          â”” PoolTimeout("couldn't get a connection after 10.00 sec")
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          â”‚    â”‚   â”‚      â”‚                      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x74172716d8a0>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716d6c0>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>
          â”” <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     â”‚    â”‚             â”‚        â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x74172716e5c0>
                     â”‚    â”‚             â”” <starlette.requests.Request object at 0x7417271967b0>
                     â”‚    â”” <bound method HTTPSRedirectMiddleware.dispatch of <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>>
                     â”” <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1mmiddleware.py[0m", line [33m149[0m, in [35mdispatch[0m
    [35m[1mreturn[0m [35m[1mawait[0m [1mcall_next[0m[1m([0m[1mrequest[0m[1m)[0m
    [36m             â”‚         â”” [0m[36m[1m<starlette.requests.Request object at 0x7417271967b0>[0m
    [36m             â”” [0m[36m[1m<function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x74172716e5c0>[0m

  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          â”” PoolTimeout("couldn't get a connection after 10.00 sec")
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          â”‚    â”‚   â”‚      â”‚                      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x741724fec2c0>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716e840>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <starlette.middleware.cors.CORSMiddleware object at 0x7417272b13a0>
          â”” <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          â”‚    â”‚   â”‚      â”‚        â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x741724fec2c0>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716e840>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7417272b1fd0>
          â”” <starlette.middleware.cors.CORSMiddleware object at 0x7417272b13a0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          â”‚    â”‚   â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716f920>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716e840>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7417272b18b0>
          â”” <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7417272b1fd0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          â”‚    â”‚   â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716f920>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716e840>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <fastapi.routing.APIRouter object at 0x741727b89f40>
          â”” <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7417272b18b0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          â”‚     â”‚      â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716f920>
          â”‚     â”‚      â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716e840>
          â”‚     â”‚      â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚     â”” <function Route.handle at 0x74172c65b600>
          â”” APIRoute(path='/subscriptions', name='list_subscriptions', methods=['GET'])
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          â”‚    â”‚   â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716f920>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716e840>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <function request_response.<locals>.app at 0x7417272b6e80>
          â”” APIRoute(path='/subscriptions', name='list_subscriptions', methods=['GET'])
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     â”‚    â”” <starlette.requests.Request object at 0x741727196c30>
                     â”” <function get_request_handler.<locals>.app at 0x7417272b6f20>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         â”” <function run_endpoint_function at 0x74172c659e40>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 â”‚         â”‚      â”” {'status': None, 'limit': 100, 'offset': 0, 'request': <starlette.requests.Request object at 0x741727196c30>}
                 â”‚         â”” <function list_subscriptions at 0x7417272b58a0>
                 â”” <fastapi.dependencies.models.Dependant object at 0x7417272caf90>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/slowapi/extension.py", line 734, in async_wrapper
    response = await func(*args, **kwargs)  # type: ignore
                     â”‚     â”‚       â”” {'status': None, 'limit': 100, 'offset': 0, 'request': <starlette.requests.Request object at 0x741727196c30>}
                     â”‚     â”” ()
                     â”” <function list_subscriptions at 0x7417272b56c0>

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1mmain.py[0m", line [33m738[0m, in [35mlist_subscriptions[0m
    [1mrecords[0m [35m[1m=[0m [35m[1mawait[0m [1msubscription_store[0m[35m[1m.[0m[1mlist_all[0m[1m([0m[1m)[0m
    [36m                â”‚                  â”” [0m[36m[1m<function SubscriptionStore.list_all at 0x74172bcd0360>[0m
    [36m                â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m157[0m, in [35mlist_all[0m
    [35m[1mreturn[0m [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1m_fetch[0m[1m([0m[1m)[0m
    [36m             â”‚    â”” [0m[36m[1m<function SubscriptionStore._fetch at 0x74172bcd0220>[0m
    [36m             â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m164[0m, in [35m_fetch[0m
    [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1minitialise[0m[1m([0m[1m)[0m
    [36m      â”‚    â”” [0m[36m[1m<function SubscriptionStore.initialise at 0x74172bcd0900>[0m
    [36m      â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m47[0m, in [35minitialise[0m
    [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1m_ensure_schema[0m[1m([0m[1m)[0m
    [36m      â”‚    â”” [0m[36m[1m<function SubscriptionStore._ensure_schema at 0x74172bcd0180>[0m
    [36m      â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m206[0m, in [35m_ensure_schema[0m
    [35m[1masync[0m [35m[1mwith[0m [1mself[0m[35m[1m.[0m[1m_pool[0m[35m[1m.[0m[1mconnection[0m[1m([0m[1m)[0m [35m[1mas[0m [1mconn[0m[1m:[0m
    [36m           â”‚    â”‚     â”” [0m[36m[1m<function AsyncConnectionPool.connection at 0x74172934b100>[0m
    [36m           â”‚    â”” [0m[36m[1m<psycopg_pool.pool_async.AsyncConnectionPool 'pool-2' at 0x7417271acb30>[0m
    [36m           â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "/usr/lib/python3.12/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
                       â”‚    â”” <async_generator object AsyncConnectionPool.connection at 0x741724fe4280>
                       â”” <contextlib._AsyncGeneratorContextManager object at 0x7417271ac8c0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/psycopg_pool/pool_async.py", line 194, in connection
    conn = await self.getconn(timeout=timeout)
                 â”‚    â”‚               â”” None
                 â”‚    â”” <function AsyncConnectionPool.getconn at 0x74172934b1a0>
                 â”” <psycopg_pool.pool_async.AsyncConnectionPool 'pool-2' at 0x7417271acb30>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/psycopg_pool/pool_async.py", line 229, in getconn
    raise PoolTimeout(
          â”” <class 'psycopg_pool.PoolTimeout'>

[31m[1mpsycopg_pool.PoolTimeout[0m:[1m couldn't get a connection after 10.00 sec[0m
[32m2025-11-09 06:34:40.660[0m | [31m[1mERROR   [0m | [36mapp.main[0m:[36mglobal_exception_handler[0m:[36m506[0m - [31m[1mUnhandled exception in GET /subscriptions[0m
[33m[1mTraceback (most recent call last):[0m

  File "/usr/lib/python3.12/threading.py", line 1030, in _bootstrap
    self._bootstrap_inner()
    â”‚    â”” <function Thread._bootstrap_inner at 0x74172efaaf20>
    â”” <Thread(ThreadPoolExecutor-2_0, started 127642788325056)>
  File "/usr/lib/python3.12/threading.py", line 1073, in _bootstrap_inner
    self.run()
    â”‚    â”” <function Thread.run at 0x74172efaac00>
    â”” <Thread(ThreadPoolExecutor-2_0, started 127642788325056)>
  File "/usr/lib/python3.12/threading.py", line 1010, in run
    self._target(*self._args, **self._kwargs)
    â”‚    â”‚        â”‚    â”‚        â”‚    â”” {}
    â”‚    â”‚        â”‚    â”‚        â”” <Thread(ThreadPoolExecutor-2_0, started 127642788325056)>
    â”‚    â”‚        â”‚    â”” (<weakref at 0x7417271ddda0; to 'ThreadPoolExecutor' at 0x741727195400>, <_queue.SimpleQueue object at 0x7417271c52b0>, None,...
    â”‚    â”‚        â”” <Thread(ThreadPoolExecutor-2_0, started 127642788325056)>
    â”‚    â”” <function _worker at 0x74172d709ee0>
    â”” <Thread(ThreadPoolExecutor-2_0, started 127642788325056)>
  File "/usr/lib/python3.12/concurrent/futures/thread.py", line 92, in _worker
    work_item.run()
    â”‚         â”” <function _WorkItem.run at 0x74172d70a020>
    â”” <concurrent.futures.thread._WorkItem object at 0x7417271952e0>
  File "/usr/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             â”‚    â”‚   â”‚    â”‚       â”‚    â”” {'backend': 'asyncio', 'backend_options': {}}
             â”‚    â”‚   â”‚    â”‚       â”” <concurrent.futures.thread._WorkItem object at 0x7417271952e0>
             â”‚    â”‚   â”‚    â”” (<function start_blocking_portal.<locals>.run_portal at 0x74172716f4c0>,)
             â”‚    â”‚   â”” <concurrent.futures.thread._WorkItem object at 0x7417271952e0>
             â”‚    â”” <function run at 0x74172d69b4c0>
             â”” <concurrent.futures.thread._WorkItem object at 0x7417271952e0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/_core/_eventloop.py", line 68, in run
    return asynclib.run(func, *args, **backend_options)
           â”‚        â”‚   â”‚      â”‚       â”” {}
           â”‚        â”‚   â”‚      â”” ()
           â”‚        â”‚   â”” <function start_blocking_portal.<locals>.run_portal at 0x74172716f4c0>
           â”‚        â”” <function run at 0x741727228c20>
           â”” <module 'anyio._backends._asyncio' from '/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/_backends/_asyncio.py'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 204, in run
    return native_run(wrapper(), debug=debug)
           â”‚          â”‚                â”” False
           â”‚          â”” <function start_blocking_portal.<locals>.run_portal at 0x74172716f560>
           â”” <function run at 0x74172d7d3ba0>
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           â”‚      â”‚   â”” <coroutine object start_blocking_portal.<locals>.run_portal at 0x74172710f6a0>
           â”‚      â”” <function Runner.run at 0x74172d835580>
           â”” <asyncio.runners.Runner object at 0x741727195520>
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           â”‚    â”‚     â”‚                  â”” <Task pending name='anyio.from_thread.start_blocking_portal.<locals>.run_portal' coro=<start_blocking_portal.<locals>.run_por...
           â”‚    â”‚     â”” <function BaseEventLoop.run_until_complete at 0x74172d82b1a0>
           â”‚    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
           â”” <asyncio.runners.Runner object at 0x741727195520>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    â”‚    â”” <function BaseEventLoop.run_forever at 0x74172d82b100>
    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    â”‚    â”” <function BaseEventLoop._run_once at 0x74172d834f40>
    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
    â”‚      â”” <function Handle._run at 0x74172d7c1260>
    â”” <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    â”‚    â”‚            â”‚    â”‚           â”‚    â”” <member '_args' of 'Handle' objects>
    â”‚    â”‚            â”‚    â”‚           â”” <Handle Task.task_wakeup(<Future finished result=None>)>
    â”‚    â”‚            â”‚    â”” <member '_callback' of 'Handle' objects>
    â”‚    â”‚            â”” <Handle Task.task_wakeup(<Future finished result=None>)>
    â”‚    â”” <member '_context' of 'Handle' objects>
    â”” <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/from_thread.py", line 217, in _call_func
    retval = await retval
                   â”” <coroutine object FastAPI.__call__ at 0x7417271b0310>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           â”‚      â”‚        â”” <function _TestClientTransport.handle_request.<locals>.send at 0x74172716e160>
                           â”‚      â”” <function _TestClientTransport.handle_request.<locals>.receive at 0x74172716f420>
                           â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          â”‚    â”‚                â”‚      â”‚        â”” <function _TestClientTransport.handle_request.<locals>.send at 0x74172716e160>
          â”‚    â”‚                â”‚      â”” <function _TestClientTransport.handle_request.<locals>.receive at 0x74172716f420>
          â”‚    â”‚                â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <starlette.middleware.errors.ServerErrorMiddleware object at 0x741727b1c2c0>
          â”” <fastapi.applications.FastAPI object at 0x741727b89e50>
> File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          â”‚    â”‚   â”‚      â”‚        â”” <function ServerErrorMiddleware.__call__.<locals>._send at 0x74172716fc40>
          â”‚    â”‚   â”‚      â”” <function _TestClientTransport.handle_request.<locals>.receive at 0x74172716f420>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>
          â”” <starlette.middleware.errors.ServerErrorMiddleware object at 0x741727b1c2c0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     â”‚    â”‚             â”‚        â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x74172716d9e0>
                     â”‚    â”‚             â”” <starlette.requests.Request object at 0x741727196300>
                     â”‚    â”” <bound method RequestIDMiddleware.dispatch of <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>>
                     â”” <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1mmiddleware.py[0m", line [33m57[0m, in [35mdispatch[0m
    [1mresponse[0m [35m[1m=[0m [35m[1mawait[0m [1mcall_next[0m[1m([0m[1mrequest[0m[1m)[0m
    [36m                 â”‚         â”” [0m[36m[1m<starlette.requests.Request object at 0x741727196300>[0m
    [36m                 â”” [0m[36m[1m<function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x74172716d9e0>[0m

  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          â”” PoolTimeout("couldn't get a connection after 10.00 sec")
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          â”‚    â”‚   â”‚      â”‚                      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x74172716d8a0>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716d6c0>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>
          â”” <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     â”‚    â”‚             â”‚        â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x74172716e5c0>
                     â”‚    â”‚             â”” <starlette.requests.Request object at 0x7417271967b0>
                     â”‚    â”” <bound method HTTPSRedirectMiddleware.dispatch of <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>>
                     â”” <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1mmiddleware.py[0m", line [33m149[0m, in [35mdispatch[0m
    [35m[1mreturn[0m [35m[1mawait[0m [1mcall_next[0m[1m([0m[1mrequest[0m[1m)[0m
    [36m             â”‚         â”” [0m[36m[1m<starlette.requests.Request object at 0x7417271967b0>[0m
    [36m             â”” [0m[36m[1m<function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x74172716e5c0>[0m

  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          â”” PoolTimeout("couldn't get a connection after 10.00 sec")
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          â”‚    â”‚   â”‚      â”‚                      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x741724fec2c0>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716e840>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <starlette.middleware.cors.CORSMiddleware object at 0x7417272b13a0>
          â”” <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          â”‚    â”‚   â”‚      â”‚        â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x741724fec2c0>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716e840>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7417272b1fd0>
          â”” <starlette.middleware.cors.CORSMiddleware object at 0x7417272b13a0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          â”‚    â”‚   â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716f920>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716e840>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7417272b18b0>
          â”” <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7417272b1fd0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          â”‚    â”‚   â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716f920>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716e840>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <fastapi.routing.APIRouter object at 0x741727b89f40>
          â”” <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7417272b18b0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          â”‚     â”‚      â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716f920>
          â”‚     â”‚      â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716e840>
          â”‚     â”‚      â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚     â”” <function Route.handle at 0x74172c65b600>
          â”” APIRoute(path='/subscriptions', name='list_subscriptions', methods=['GET'])
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          â”‚    â”‚   â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716f920>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716e840>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions', 'root_path'...
          â”‚    â”” <function request_response.<locals>.app at 0x7417272b6e80>
          â”” APIRoute(path='/subscriptions', name='list_subscriptions', methods=['GET'])
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     â”‚    â”” <starlette.requests.Request object at 0x741727196c30>
                     â”” <function get_request_handler.<locals>.app at 0x7417272b6f20>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         â”” <function run_endpoint_function at 0x74172c659e40>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 â”‚         â”‚      â”” {'status': None, 'limit': 100, 'offset': 0, 'request': <starlette.requests.Request object at 0x741727196c30>}
                 â”‚         â”” <function list_subscriptions at 0x7417272b58a0>
                 â”” <fastapi.dependencies.models.Dependant object at 0x7417272caf90>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/slowapi/extension.py", line 734, in async_wrapper
    response = await func(*args, **kwargs)  # type: ignore
                     â”‚     â”‚       â”” {'status': None, 'limit': 100, 'offset': 0, 'request': <starlette.requests.Request object at 0x741727196c30>}
                     â”‚     â”” ()
                     â”” <function list_subscriptions at 0x7417272b56c0>

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1mmain.py[0m", line [33m738[0m, in [35mlist_subscriptions[0m
    [1mrecords[0m [35m[1m=[0m [35m[1mawait[0m [1msubscription_store[0m[35m[1m.[0m[1mlist_all[0m[1m([0m[1m)[0m
    [36m                â”‚                  â”” [0m[36m[1m<function SubscriptionStore.list_all at 0x74172bcd0360>[0m
    [36m                â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m157[0m, in [35mlist_all[0m
    [35m[1mreturn[0m [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1m_fetch[0m[1m([0m[1m)[0m
    [36m             â”‚    â”” [0m[36m[1m<function SubscriptionStore._fetch at 0x74172bcd0220>[0m
    [36m             â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m164[0m, in [35m_fetch[0m
    [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1minitialise[0m[1m([0m[1m)[0m
    [36m      â”‚    â”” [0m[36m[1m<function SubscriptionStore.initialise at 0x74172bcd0900>[0m
    [36m      â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m47[0m, in [35minitialise[0m
    [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1m_ensure_schema[0m[1m([0m[1m)[0m
    [36m      â”‚    â”” [0m[36m[1m<function SubscriptionStore._ensure_schema at 0x74172bcd0180>[0m
    [36m      â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m206[0m, in [35m_ensure_schema[0m
    [35m[1masync[0m [35m[1mwith[0m [1mself[0m[35m[1m.[0m[1m_pool[0m[35m[1m.[0m[1mconnection[0m[1m([0m[1m)[0m [35m[1mas[0m [1mconn[0m[1m:[0m
    [36m           â”‚    â”‚     â”” [0m[36m[1m<function AsyncConnectionPool.connection at 0x74172934b100>[0m
    [36m           â”‚    â”” [0m[36m[1m<psycopg_pool.pool_async.AsyncConnectionPool 'pool-2' at 0x7417271acb30>[0m
    [36m           â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "/usr/lib/python3.12/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
                       â”‚    â”” <async_generator object AsyncConnectionPool.connection at 0x741724fe4280>
                       â”” <contextlib._AsyncGeneratorContextManager object at 0x7417271ac8c0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/psycopg_pool/pool_async.py", line 194, in connection
    conn = await self.getconn(timeout=timeout)
                 â”‚    â”‚               â”” None
                 â”‚    â”” <function AsyncConnectionPool.getconn at 0x74172934b1a0>
                 â”” <psycopg_pool.pool_async.AsyncConnectionPool 'pool-2' at 0x7417271acb30>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/psycopg_pool/pool_async.py", line 229, in getconn
    raise PoolTimeout(
          â”” <class 'psycopg_pool.PoolTimeout'>

[31m[1mpsycopg_pool.PoolTimeout[0m:[1m couldn't get a connection after 10.00 sec[0m
------------------------------ Captured log call -------------------------------
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-2': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-2': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-2': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-2': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-2': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-2': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-2': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-2': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
________________________ test_subscriptions_pagination _________________________
tests/integration/test_api_endpoints.py:42: in test_subscriptions_pagination
    response = client.get("/subscriptions?limit=10&offset=0")
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/testclient.py:499: in get
    return super().get(
/home/stocksadmin/.local/lib/python3.12/site-packages/httpx/_client.py:1041: in get
    return self.request(
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/testclient.py:465: in request
    return super().request(
/home/stocksadmin/.local/lib/python3.12/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
/home/stocksadmin/.local/lib/python3.12/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
/home/stocksadmin/.local/lib/python3.12/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
/home/stocksadmin/.local/lib/python3.12/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
/home/stocksadmin/.local/lib/python3.12/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/testclient.py:342: in handle_request
    raise exc
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/testclient.py:339: in handle_request
    portal.call(self.app, scope, receive, send)
/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/lib/python3.12/concurrent/futures/_base.py:456: in result
    return self.__get_result()
/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/errors.py:184: in __call__
    raise exc
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/errors.py:162: in __call__
    await self.app(scope, receive, _send)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware.py:57: in dispatch
    response = await call_next(request)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py:84: in call_next
    raise app_exc
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py:70: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py:108: in __call__
    response = await self.dispatch_func(request, call_next)
app/middleware.py:149: in dispatch
    return await call_next(request)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py:84: in call_next
    raise app_exc
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py:70: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__
    await self.app(scope, receive, send)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:79: in __call__
    raise exc
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/exceptions.py:68: in __call__
    await self.app(scope, receive, sender)
/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:20: in __call__
    raise e
/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:17: in __call__
    await self.app(scope, receive, send)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py:718: in __call__
    await route.handle(scope, receive, send)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py:276: in handle
    await self.app(scope, receive, send)
/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py:66: in app
    response = await func(request)
/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/routing.py:274: in app
    raw_response = await run_endpoint_function(
/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function
    return await dependant.call(**values)
/home/stocksadmin/.local/lib/python3.12/site-packages/slowapi/extension.py:734: in async_wrapper
    response = await func(*args, **kwargs)  # type: ignore
app/main.py:738: in list_subscriptions
    records = await subscription_store.list_all()
app/subscription_store.py:157: in list_all
    return await self._fetch()
app/subscription_store.py:164: in _fetch
    await self.initialise()
app/subscription_store.py:47: in initialise
    await self._ensure_schema()
app/subscription_store.py:206: in _ensure_schema
    async with self._pool.connection() as conn:
/usr/lib/python3.12/contextlib.py:210: in __aenter__
    return await anext(self.gen)
/home/stocksadmin/.local/lib/python3.12/site-packages/psycopg_pool/pool_async.py:194: in connection
    conn = await self.getconn(timeout=timeout)
/home/stocksadmin/.local/lib/python3.12/site-packages/psycopg_pool/pool_async.py:229: in getconn
    raise PoolTimeout(
E   psycopg_pool.PoolTimeout: couldn't get a connection after 10.00 sec
----------------------------- Captured stdout call -----------------------------
[32m2025-11-09 06:34:41.187[0m | [1mINFO    [0m | [36mapp.middleware[0m:[36mdispatch[0m:[36m45[0m - [1mRequest started: GET /subscriptions[0m
[32m2025-11-09 06:34:51.196[0m | [31m[1mERROR   [0m | [36mapp.middleware[0m:[36mdispatch[0m:[36m77[0m - [31m[1mRequest failed: GET /subscriptions[0m
[33m[1mTraceback (most recent call last):[0m

  File "/usr/lib/python3.12/threading.py", line 1030, in _bootstrap
    self._bootstrap_inner()
    â”‚    â”” <function Thread._bootstrap_inner at 0x74172efaaf20>
    â”” <Thread(ThreadPoolExecutor-3_0, started 127642788325056)>
  File "/usr/lib/python3.12/threading.py", line 1073, in _bootstrap_inner
    self.run()
    â”‚    â”” <function Thread.run at 0x74172efaac00>
    â”” <Thread(ThreadPoolExecutor-3_0, started 127642788325056)>
  File "/usr/lib/python3.12/threading.py", line 1010, in run
    self._target(*self._args, **self._kwargs)
    â”‚    â”‚        â”‚    â”‚        â”‚    â”” {}
    â”‚    â”‚        â”‚    â”‚        â”” <Thread(ThreadPoolExecutor-3_0, started 127642788325056)>
    â”‚    â”‚        â”‚    â”” (<weakref at 0x7417271dd7b0; to 'ThreadPoolExecutor' at 0x7417271ac3b0>, <_queue.SimpleQueue object at 0x741724fdd080>, None,...
    â”‚    â”‚        â”” <Thread(ThreadPoolExecutor-3_0, started 127642788325056)>
    â”‚    â”” <function _worker at 0x74172d709ee0>
    â”” <Thread(ThreadPoolExecutor-3_0, started 127642788325056)>
  File "/usr/lib/python3.12/concurrent/futures/thread.py", line 92, in _worker
    work_item.run()
    â”‚         â”” <function _WorkItem.run at 0x74172d70a020>
    â”” <concurrent.futures.thread._WorkItem object at 0x7417271ad910>
  File "/usr/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             â”‚    â”‚   â”‚    â”‚       â”‚    â”” {'backend': 'asyncio', 'backend_options': {}}
             â”‚    â”‚   â”‚    â”‚       â”” <concurrent.futures.thread._WorkItem object at 0x7417271ad910>
             â”‚    â”‚   â”‚    â”” (<function start_blocking_portal.<locals>.run_portal at 0x74172716c4a0>,)
             â”‚    â”‚   â”” <concurrent.futures.thread._WorkItem object at 0x7417271ad910>
             â”‚    â”” <function run at 0x74172d69b4c0>
             â”” <concurrent.futures.thread._WorkItem object at 0x7417271ad910>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/_core/_eventloop.py", line 68, in run
    return asynclib.run(func, *args, **backend_options)
           â”‚        â”‚   â”‚      â”‚       â”” {}
           â”‚        â”‚   â”‚      â”” ()
           â”‚        â”‚   â”” <function start_blocking_portal.<locals>.run_portal at 0x74172716c4a0>
           â”‚        â”” <function run at 0x741727228c20>
           â”” <module 'anyio._backends._asyncio' from '/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/_backends/_asyncio.py'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 204, in run
    return native_run(wrapper(), debug=debug)
           â”‚          â”‚                â”” False
           â”‚          â”” <function start_blocking_portal.<locals>.run_portal at 0x74172716f1a0>
           â”” <function run at 0x74172d7d3ba0>
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           â”‚      â”‚   â”” <coroutine object start_blocking_portal.<locals>.run_portal at 0x741727b27a60>
           â”‚      â”” <function Runner.run at 0x74172d835580>
           â”” <asyncio.runners.Runner object at 0x7417271acf20>
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           â”‚    â”‚     â”‚                  â”” <Task pending name='anyio.from_thread.start_blocking_portal.<locals>.run_portal' coro=<start_blocking_portal.<locals>.run_por...
           â”‚    â”‚     â”” <function BaseEventLoop.run_until_complete at 0x74172d82b1a0>
           â”‚    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
           â”” <asyncio.runners.Runner object at 0x7417271acf20>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    â”‚    â”” <function BaseEventLoop.run_forever at 0x74172d82b100>
    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    â”‚    â”” <function BaseEventLoop._run_once at 0x74172d834f40>
    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
    â”‚      â”” <function Handle._run at 0x74172d7c1260>
    â”” <Handle <_asyncio.TaskStepMethWrapper object at 0x741727131300>()>
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    â”‚    â”‚            â”‚    â”‚           â”‚    â”” <member '_args' of 'Handle' objects>
    â”‚    â”‚            â”‚    â”‚           â”” <Handle <_asyncio.TaskStepMethWrapper object at 0x741727131300>()>
    â”‚    â”‚            â”‚    â”” <member '_callback' of 'Handle' objects>
    â”‚    â”‚            â”” <Handle <_asyncio.TaskStepMethWrapper object at 0x741727131300>()>
    â”‚    â”” <member '_context' of 'Handle' objects>
    â”” <Handle <_asyncio.TaskStepMethWrapper object at 0x741727131300>()>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/from_thread.py", line 217, in _call_func
    retval = await retval
                   â”” <coroutine object FastAPI.__call__ at 0x7417271b0e50>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           â”‚      â”‚        â”” <function _TestClientTransport.handle_request.<locals>.send at 0x741727147060>
                           â”‚      â”” <function _TestClientTransport.handle_request.<locals>.receive at 0x741727146f20>
                           â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          â”‚    â”‚                â”‚      â”‚        â”” <function _TestClientTransport.handle_request.<locals>.send at 0x741727147060>
          â”‚    â”‚                â”‚      â”” <function _TestClientTransport.handle_request.<locals>.receive at 0x741727146f20>
          â”‚    â”‚                â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <starlette.middleware.errors.ServerErrorMiddleware object at 0x741727b1c2c0>
          â”” <fastapi.applications.FastAPI object at 0x741727b89e50>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          â”‚    â”‚   â”‚      â”‚        â”” <function ServerErrorMiddleware.__call__.<locals>._send at 0x74172716f2e0>
          â”‚    â”‚   â”‚      â”” <function _TestClientTransport.handle_request.<locals>.receive at 0x741727146f20>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>
          â”” <starlette.middleware.errors.ServerErrorMiddleware object at 0x741727b1c2c0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     â”‚    â”‚             â”‚        â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x74172716efc0>
                     â”‚    â”‚             â”” <starlette.requests.Request object at 0x7417271310a0>
                     â”‚    â”” <bound method RequestIDMiddleware.dispatch of <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>>
                     â”” <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>

> File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1mmiddleware.py[0m", line [33m57[0m, in [35mdispatch[0m
    [1mresponse[0m [35m[1m=[0m [35m[1mawait[0m [1mcall_next[0m[1m([0m[1mrequest[0m[1m)[0m
    [36m                 â”‚         â”” [0m[36m[1m<starlette.requests.Request object at 0x7417271310a0>[0m
    [36m                 â”” [0m[36m[1m<function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x74172716efc0>[0m

  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          â”” PoolTimeout("couldn't get a connection after 10.00 sec")
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          â”‚    â”‚   â”‚      â”‚                      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x74172716db20>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716f100>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>
          â”” <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     â”‚    â”‚             â”‚        â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x741724fecea0>
                     â”‚    â”‚             â”” <starlette.requests.Request object at 0x741727132210>
                     â”‚    â”” <bound method HTTPSRedirectMiddleware.dispatch of <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>>
                     â”” <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1mmiddleware.py[0m", line [33m149[0m, in [35mdispatch[0m
    [35m[1mreturn[0m [35m[1mawait[0m [1mcall_next[0m[1m([0m[1mrequest[0m[1m)[0m
    [36m             â”‚         â”” [0m[36m[1m<starlette.requests.Request object at 0x741727132210>[0m
    [36m             â”” [0m[36m[1m<function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x741724fecea0>[0m

  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          â”” PoolTimeout("couldn't get a connection after 10.00 sec")
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          â”‚    â”‚   â”‚      â”‚                      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x741724fed580>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x741724fed6c0>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <starlette.middleware.cors.CORSMiddleware object at 0x7417272b13a0>
          â”” <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          â”‚    â”‚   â”‚      â”‚        â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x741724fed580>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x741724fed6c0>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7417272b1fd0>
          â”” <starlette.middleware.cors.CORSMiddleware object at 0x7417272b13a0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          â”‚    â”‚   â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716d580>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x741724fed6c0>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7417272b18b0>
          â”” <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7417272b1fd0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          â”‚    â”‚   â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716d580>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x741724fed6c0>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <fastapi.routing.APIRouter object at 0x741727b89f40>
          â”” <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7417272b18b0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          â”‚     â”‚      â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716d580>
          â”‚     â”‚      â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x741724fed6c0>
          â”‚     â”‚      â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚     â”” <function Route.handle at 0x74172c65b600>
          â”” APIRoute(path='/subscriptions', name='list_subscriptions', methods=['GET'])
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          â”‚    â”‚   â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716d580>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x741724fed6c0>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <function request_response.<locals>.app at 0x7417272b6e80>
          â”” APIRoute(path='/subscriptions', name='list_subscriptions', methods=['GET'])
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     â”‚    â”” <starlette.requests.Request object at 0x741727dda6f0>
                     â”” <function get_request_handler.<locals>.app at 0x7417272b6f20>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         â”” <function run_endpoint_function at 0x74172c659e40>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 â”‚         â”‚      â”” {'status': None, 'limit': 10, 'offset': 0, 'request': <starlette.requests.Request object at 0x741727dda6f0>}
                 â”‚         â”” <function list_subscriptions at 0x7417272b58a0>
                 â”” <fastapi.dependencies.models.Dependant object at 0x7417272caf90>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/slowapi/extension.py", line 734, in async_wrapper
    response = await func(*args, **kwargs)  # type: ignore
                     â”‚     â”‚       â”” {'status': None, 'limit': 10, 'offset': 0, 'request': <starlette.requests.Request object at 0x741727dda6f0>}
                     â”‚     â”” ()
                     â”” <function list_subscriptions at 0x7417272b56c0>

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1mmain.py[0m", line [33m738[0m, in [35mlist_subscriptions[0m
    [1mrecords[0m [35m[1m=[0m [35m[1mawait[0m [1msubscription_store[0m[35m[1m.[0m[1mlist_all[0m[1m([0m[1m)[0m
    [36m                â”‚                  â”” [0m[36m[1m<function SubscriptionStore.list_all at 0x74172bcd0360>[0m
    [36m                â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m157[0m, in [35mlist_all[0m
    [35m[1mreturn[0m [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1m_fetch[0m[1m([0m[1m)[0m
    [36m             â”‚    â”” [0m[36m[1m<function SubscriptionStore._fetch at 0x74172bcd0220>[0m
    [36m             â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m164[0m, in [35m_fetch[0m
    [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1minitialise[0m[1m([0m[1m)[0m
    [36m      â”‚    â”” [0m[36m[1m<function SubscriptionStore.initialise at 0x74172bcd0900>[0m
    [36m      â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m47[0m, in [35minitialise[0m
    [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1m_ensure_schema[0m[1m([0m[1m)[0m
    [36m      â”‚    â”” [0m[36m[1m<function SubscriptionStore._ensure_schema at 0x74172bcd0180>[0m
    [36m      â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m206[0m, in [35m_ensure_schema[0m
    [35m[1masync[0m [35m[1mwith[0m [1mself[0m[35m[1m.[0m[1m_pool[0m[35m[1m.[0m[1mconnection[0m[1m([0m[1m)[0m [35m[1mas[0m [1mconn[0m[1m:[0m
    [36m           â”‚    â”‚     â”” [0m[36m[1m<function AsyncConnectionPool.connection at 0x74172934b100>[0m
    [36m           â”‚    â”” [0m[36m[1m<psycopg_pool.pool_async.AsyncConnectionPool 'pool-3' at 0x741727195850>[0m
    [36m           â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "/usr/lib/python3.12/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
                       â”‚    â”” <async_generator object AsyncConnectionPool.connection at 0x741724fe4ee0>
                       â”” <contextlib._AsyncGeneratorContextManager object at 0x741727195820>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/psycopg_pool/pool_async.py", line 194, in connection
    conn = await self.getconn(timeout=timeout)
                 â”‚    â”‚               â”” None
                 â”‚    â”” <function AsyncConnectionPool.getconn at 0x74172934b1a0>
                 â”” <psycopg_pool.pool_async.AsyncConnectionPool 'pool-3' at 0x741727195850>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/psycopg_pool/pool_async.py", line 229, in getconn
    raise PoolTimeout(
          â”” <class 'psycopg_pool.PoolTimeout'>

[31m[1mpsycopg_pool.PoolTimeout[0m:[1m couldn't get a connection after 10.00 sec[0m
[32m2025-11-09 06:34:51.213[0m | [31m[1mERROR   [0m | [36mapp.main[0m:[36mglobal_exception_handler[0m:[36m506[0m - [31m[1mUnhandled exception in GET /subscriptions[0m
[33m[1mTraceback (most recent call last):[0m

  File "/usr/lib/python3.12/threading.py", line 1030, in _bootstrap
    self._bootstrap_inner()
    â”‚    â”” <function Thread._bootstrap_inner at 0x74172efaaf20>
    â”” <Thread(ThreadPoolExecutor-3_0, started 127642788325056)>
  File "/usr/lib/python3.12/threading.py", line 1073, in _bootstrap_inner
    self.run()
    â”‚    â”” <function Thread.run at 0x74172efaac00>
    â”” <Thread(ThreadPoolExecutor-3_0, started 127642788325056)>
  File "/usr/lib/python3.12/threading.py", line 1010, in run
    self._target(*self._args, **self._kwargs)
    â”‚    â”‚        â”‚    â”‚        â”‚    â”” {}
    â”‚    â”‚        â”‚    â”‚        â”” <Thread(ThreadPoolExecutor-3_0, started 127642788325056)>
    â”‚    â”‚        â”‚    â”” (<weakref at 0x7417271dd7b0; to 'ThreadPoolExecutor' at 0x7417271ac3b0>, <_queue.SimpleQueue object at 0x741724fdd080>, None,...
    â”‚    â”‚        â”” <Thread(ThreadPoolExecutor-3_0, started 127642788325056)>
    â”‚    â”” <function _worker at 0x74172d709ee0>
    â”” <Thread(ThreadPoolExecutor-3_0, started 127642788325056)>
  File "/usr/lib/python3.12/concurrent/futures/thread.py", line 92, in _worker
    work_item.run()
    â”‚         â”” <function _WorkItem.run at 0x74172d70a020>
    â”” <concurrent.futures.thread._WorkItem object at 0x7417271ad910>
  File "/usr/lib/python3.12/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             â”‚    â”‚   â”‚    â”‚       â”‚    â”” {'backend': 'asyncio', 'backend_options': {}}
             â”‚    â”‚   â”‚    â”‚       â”” <concurrent.futures.thread._WorkItem object at 0x7417271ad910>
             â”‚    â”‚   â”‚    â”” (<function start_blocking_portal.<locals>.run_portal at 0x74172716c4a0>,)
             â”‚    â”‚   â”” <concurrent.futures.thread._WorkItem object at 0x7417271ad910>
             â”‚    â”” <function run at 0x74172d69b4c0>
             â”” <concurrent.futures.thread._WorkItem object at 0x7417271ad910>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/_core/_eventloop.py", line 68, in run
    return asynclib.run(func, *args, **backend_options)
           â”‚        â”‚   â”‚      â”‚       â”” {}
           â”‚        â”‚   â”‚      â”” ()
           â”‚        â”‚   â”” <function start_blocking_portal.<locals>.run_portal at 0x74172716c4a0>
           â”‚        â”” <function run at 0x741727228c20>
           â”” <module 'anyio._backends._asyncio' from '/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/_backends/_asyncio.py'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 204, in run
    return native_run(wrapper(), debug=debug)
           â”‚          â”‚                â”” False
           â”‚          â”” <function start_blocking_portal.<locals>.run_portal at 0x74172716f1a0>
           â”” <function run at 0x74172d7d3ba0>
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           â”‚      â”‚   â”” <coroutine object start_blocking_portal.<locals>.run_portal at 0x741727b27a60>
           â”‚      â”” <function Runner.run at 0x74172d835580>
           â”” <asyncio.runners.Runner object at 0x7417271acf20>
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           â”‚    â”‚     â”‚                  â”” <Task pending name='anyio.from_thread.start_blocking_portal.<locals>.run_portal' coro=<start_blocking_portal.<locals>.run_por...
           â”‚    â”‚     â”” <function BaseEventLoop.run_until_complete at 0x74172d82b1a0>
           â”‚    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
           â”” <asyncio.runners.Runner object at 0x7417271acf20>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    â”‚    â”” <function BaseEventLoop.run_forever at 0x74172d82b100>
    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    â”‚    â”” <function BaseEventLoop._run_once at 0x74172d834f40>
    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
    â”‚      â”” <function Handle._run at 0x74172d7c1260>
    â”” <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    â”‚    â”‚            â”‚    â”‚           â”‚    â”” <member '_args' of 'Handle' objects>
    â”‚    â”‚            â”‚    â”‚           â”” <Handle Task.task_wakeup(<Future finished result=None>)>
    â”‚    â”‚            â”‚    â”” <member '_callback' of 'Handle' objects>
    â”‚    â”‚            â”” <Handle Task.task_wakeup(<Future finished result=None>)>
    â”‚    â”” <member '_context' of 'Handle' objects>
    â”” <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/anyio/from_thread.py", line 217, in _call_func
    retval = await retval
                   â”” <coroutine object FastAPI.__call__ at 0x7417271b0e50>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
                           â”‚      â”‚        â”” <function _TestClientTransport.handle_request.<locals>.send at 0x741727147060>
                           â”‚      â”” <function _TestClientTransport.handle_request.<locals>.receive at 0x741727146f20>
                           â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          â”‚    â”‚                â”‚      â”‚        â”” <function _TestClientTransport.handle_request.<locals>.send at 0x741727147060>
          â”‚    â”‚                â”‚      â”” <function _TestClientTransport.handle_request.<locals>.receive at 0x741727146f20>
          â”‚    â”‚                â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <starlette.middleware.errors.ServerErrorMiddleware object at 0x741727b1c2c0>
          â”” <fastapi.applications.FastAPI object at 0x741727b89e50>
> File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          â”‚    â”‚   â”‚      â”‚        â”” <function ServerErrorMiddleware.__call__.<locals>._send at 0x74172716f2e0>
          â”‚    â”‚   â”‚      â”” <function _TestClientTransport.handle_request.<locals>.receive at 0x741727146f20>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>
          â”” <starlette.middleware.errors.ServerErrorMiddleware object at 0x741727b1c2c0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     â”‚    â”‚             â”‚        â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x74172716efc0>
                     â”‚    â”‚             â”” <starlette.requests.Request object at 0x7417271310a0>
                     â”‚    â”” <bound method RequestIDMiddleware.dispatch of <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>>
                     â”” <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1mmiddleware.py[0m", line [33m57[0m, in [35mdispatch[0m
    [1mresponse[0m [35m[1m=[0m [35m[1mawait[0m [1mcall_next[0m[1m([0m[1mrequest[0m[1m)[0m
    [36m                 â”‚         â”” [0m[36m[1m<starlette.requests.Request object at 0x7417271310a0>[0m
    [36m                 â”” [0m[36m[1m<function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x74172716efc0>[0m

  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          â”” PoolTimeout("couldn't get a connection after 10.00 sec")
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          â”‚    â”‚   â”‚      â”‚                      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x74172716db20>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x74172716f100>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>
          â”” <app.middleware.RequestIDMiddleware object at 0x741727dbdaf0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
                     â”‚    â”‚             â”‚        â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x741724fecea0>
                     â”‚    â”‚             â”” <starlette.requests.Request object at 0x741727132210>
                     â”‚    â”” <bound method HTTPSRedirectMiddleware.dispatch of <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>>
                     â”” <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1mmiddleware.py[0m", line [33m149[0m, in [35mdispatch[0m
    [35m[1mreturn[0m [35m[1mawait[0m [1mcall_next[0m[1m([0m[1mrequest[0m[1m)[0m
    [36m             â”‚         â”” [0m[36m[1m<starlette.requests.Request object at 0x741727132210>[0m
    [36m             â”” [0m[36m[1m<function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x741724fecea0>[0m

  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
          â”” PoolTimeout("couldn't get a connection after 10.00 sec")
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          â”‚    â”‚   â”‚      â”‚                      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x741724fed580>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x741724fed6c0>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <starlette.middleware.cors.CORSMiddleware object at 0x7417272b13a0>
          â”” <app.middleware.HTTPSRedirectMiddleware object at 0x7417272b1610>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/cors.py", line 83, in __call__
    await self.app(scope, receive, send)
          â”‚    â”‚   â”‚      â”‚        â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x741724fed580>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x741724fed6c0>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7417272b1fd0>
          â”” <starlette.middleware.cors.CORSMiddleware object at 0x7417272b13a0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          â”‚    â”‚   â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716d580>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x741724fed6c0>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7417272b18b0>
          â”” <starlette.middleware.exceptions.ExceptionMiddleware object at 0x7417272b1fd0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          â”‚    â”‚   â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716d580>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x741724fed6c0>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <fastapi.routing.APIRouter object at 0x741727b89f40>
          â”” <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x7417272b18b0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          â”‚     â”‚      â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716d580>
          â”‚     â”‚      â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x741724fed6c0>
          â”‚     â”‚      â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚     â”” <function Route.handle at 0x74172c65b600>
          â”” APIRoute(path='/subscriptions', name='list_subscriptions', methods=['GET'])
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          â”‚    â”‚   â”‚      â”‚        â”” <function ExceptionMiddleware.__call__.<locals>.sender at 0x74172716d580>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x741724fed6c0>
          â”‚    â”‚   â”” {'type': 'http', 'http_version': '1.1', 'method': 'GET', 'path': '/subscriptions', 'raw_path': b'/subscriptions?limit=10&offs...
          â”‚    â”” <function request_response.<locals>.app at 0x7417272b6e80>
          â”” APIRoute(path='/subscriptions', name='list_subscriptions', methods=['GET'])
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     â”‚    â”” <starlette.requests.Request object at 0x741727dda6f0>
                     â”” <function get_request_handler.<locals>.app at 0x7417272b6f20>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                         â”” <function run_endpoint_function at 0x74172c659e40>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/fastapi/routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 â”‚         â”‚      â”” {'status': None, 'limit': 10, 'offset': 0, 'request': <starlette.requests.Request object at 0x741727dda6f0>}
                 â”‚         â”” <function list_subscriptions at 0x7417272b58a0>
                 â”” <fastapi.dependencies.models.Dependant object at 0x7417272caf90>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/slowapi/extension.py", line 734, in async_wrapper
    response = await func(*args, **kwargs)  # type: ignore
                     â”‚     â”‚       â”” {'status': None, 'limit': 10, 'offset': 0, 'request': <starlette.requests.Request object at 0x741727dda6f0>}
                     â”‚     â”” ()
                     â”” <function list_subscriptions at 0x7417272b56c0>

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1mmain.py[0m", line [33m738[0m, in [35mlist_subscriptions[0m
    [1mrecords[0m [35m[1m=[0m [35m[1mawait[0m [1msubscription_store[0m[35m[1m.[0m[1mlist_all[0m[1m([0m[1m)[0m
    [36m                â”‚                  â”” [0m[36m[1m<function SubscriptionStore.list_all at 0x74172bcd0360>[0m
    [36m                â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m157[0m, in [35mlist_all[0m
    [35m[1mreturn[0m [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1m_fetch[0m[1m([0m[1m)[0m
    [36m             â”‚    â”” [0m[36m[1m<function SubscriptionStore._fetch at 0x74172bcd0220>[0m
    [36m             â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m164[0m, in [35m_fetch[0m
    [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1minitialise[0m[1m([0m[1m)[0m
    [36m      â”‚    â”” [0m[36m[1m<function SubscriptionStore.initialise at 0x74172bcd0900>[0m
    [36m      â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m47[0m, in [35minitialise[0m
    [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1m_ensure_schema[0m[1m([0m[1m)[0m
    [36m      â”‚    â”” [0m[36m[1m<function SubscriptionStore._ensure_schema at 0x74172bcd0180>[0m
    [36m      â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/[0m[32m[1msubscription_store.py[0m", line [33m206[0m, in [35m_ensure_schema[0m
    [35m[1masync[0m [35m[1mwith[0m [1mself[0m[35m[1m.[0m[1m_pool[0m[35m[1m.[0m[1mconnection[0m[1m([0m[1m)[0m [35m[1mas[0m [1mconn[0m[1m:[0m
    [36m           â”‚    â”‚     â”” [0m[36m[1m<function AsyncConnectionPool.connection at 0x74172934b100>[0m
    [36m           â”‚    â”” [0m[36m[1m<psycopg_pool.pool_async.AsyncConnectionPool 'pool-3' at 0x741727195850>[0m
    [36m           â”” [0m[36m[1m<app.subscription_store.SubscriptionStore object at 0x74172bcadd30>[0m

  File "/usr/lib/python3.12/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
                       â”‚    â”” <async_generator object AsyncConnectionPool.connection at 0x741724fe4ee0>
                       â”” <contextlib._AsyncGeneratorContextManager object at 0x741727195820>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/psycopg_pool/pool_async.py", line 194, in connection
    conn = await self.getconn(timeout=timeout)
                 â”‚    â”‚               â”” None
                 â”‚    â”” <function AsyncConnectionPool.getconn at 0x74172934b1a0>
                 â”” <psycopg_pool.pool_async.AsyncConnectionPool 'pool-3' at 0x741727195850>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/psycopg_pool/pool_async.py", line 229, in getconn
    raise PoolTimeout(
          â”” <class 'psycopg_pool.PoolTimeout'>

[31m[1mpsycopg_pool.PoolTimeout[0m:[1m couldn't get a connection after 10.00 sec[0m
------------------------------ Captured log call -------------------------------
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-3': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-3': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-3': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-3': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-3': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-3': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-3': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
WARNING  psycopg.pool:pool_async.py:690 error connecting in 'pool-3': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
Multiple connection attempts failed. All failures were:
- host: 'localhost', port: '5432', hostaddr: '::1': connection failed: connection to server at "::1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
- host: 'localhost', port: '5432', hostaddr: '127.0.0.1': connection failed: connection to server at "127.0.0.1", port 5432 failed: FATAL:  database "stocksblitz_unified" does not exist
_____________________________ test_option_batching _____________________________
tests/integration/test_tick_batcher.py:139: in test_option_batching
    assert batcher._total_options_flushed == 1
E   assert 0 == 1
E    +  where 0 = <app.services.tick_batcher.TickBatcher object at 0x7417271be690>._total_options_flushed
----------------------------- Captured stdout call -----------------------------
[32m2025-11-09 06:34:52.017[0m | [1mINFO    [0m | [36mapp.services.tick_batcher[0m:[36m__init__[0m:[36m79[0m - [1mTickBatcher initialized: window=100ms, max_batch=10, enabled=True[0m
[32m2025-11-09 06:34:52.017[0m | [1mINFO    [0m | [36mapp.services.tick_batcher[0m:[36mstart[0m:[36m239[0m - [1mTickBatcher started[0m
[32m2025-11-09 06:34:52.018[0m | [1mINFO    [0m | [36mapp.services.tick_batcher[0m:[36m_flusher_loop[0m:[36m205[0m - [1mTickBatcher flusher loop started[0m
[32m2025-11-09 06:34:52.119[0m | [31m[1mERROR   [0m | [36mapp.services.tick_batcher[0m:[36m_flush_options[0m:[36m189[0m - [31m[1mFailed to flush options batch: Object of type date is not JSON serializable[0m
[32m2025-11-09 06:34:52.120[0m | [31m[1mERROR   [0m | [36mapp.services.tick_batcher[0m:[36m_flusher_loop[0m:[36m220[0m - [31m[1mError in flusher loop: Object of type date is not JSON serializable[0m
[33m[1mTraceback (most recent call last):[0m

  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pytest/__main__.py", line 5, in <module>
    raise SystemExit(pytest.console_main())
                     â”‚      â”” <function console_main at 0x74172e8dd6c0>
                     â”” <module 'pytest' from '/home/stocksadmin/.local/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
           â”” <function main at 0x74172e8dd580>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
         â”‚     â”‚                â”‚      â”‚    â”” <HookCaller 'pytest_cmdline_main'>
         â”‚     â”‚                â”‚      â”” <_pytest.config.compat.PathAwareHookProxy object at 0x74172e69f1a0>
         â”‚     â”‚                â”” <_pytest.config.Config object at 0x74172e7f0140>
         â”‚     â”” <enum 'ExitCode'>
         â”” typing.Union
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”‚       â”” True
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”” {'config': <_pytest.config.Config object at 0x74172e7f0140>}
           â”‚    â”‚         â”‚    â”‚     â”‚    â”” <member '_hookimpls' of 'HookCaller' objects>
           â”‚    â”‚         â”‚    â”‚     â”” <HookCaller 'pytest_cmdline_main'>
           â”‚    â”‚         â”‚    â”” <member 'name' of 'HookCaller' objects>
           â”‚    â”‚         â”” <HookCaller 'pytest_cmdline_main'>
           â”‚    â”” <member '_hookexec' of 'HookCaller' objects>
           â”” <HookCaller 'pytest_cmdline_main'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           â”‚    â”‚               â”‚          â”‚        â”‚       â”” True
           â”‚    â”‚               â”‚          â”‚        â”” {'config': <_pytest.config.Config object at 0x74172e7f0140>}
           â”‚    â”‚               â”‚          â”” [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/stocksadmin/.local/lib/python3.12/site-packages/_pyt...
           â”‚    â”‚               â”” 'pytest_cmdline_main'
           â”‚    â”” <function _multicall at 0x74172edff380>
           â”” <_pytest.config.PytestPluginManager object at 0x74172ef31640>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          â”‚         â”‚         â”” [<_pytest.config.Config object at 0x74172e7f0140>]
          â”‚         â”” <member 'function' of 'HookImpl' objects>
          â”” <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/stocksadmin/.local/lib/python3.12/site-packages/_pyte...
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
           â”‚            â”‚       â”” <function _main at 0x74172e97f380>
           â”‚            â”” <_pytest.config.Config object at 0x74172e7f0140>
           â”” <function wrap_session at 0x74172e97f2e0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
    â”‚       â”‚            â”‚    â”‚       â”” <Session ticker_service exitstatus=<ExitCode.OK: 0> testsfailed=2 testscollected=252>
    â”‚       â”‚            â”‚    â”” <_pytest.config.Config object at 0x74172e7f0140>
    â”‚       â”‚            â”” <function _main at 0x74172e97f380>
    â”‚       â”” <ExitCode.OK: 0>
    â”” <Session ticker_service exitstatus=<ExitCode.OK: 0> testsfailed=2 testscollected=252>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
    â”‚      â”‚    â”‚                          â”” <Session ticker_service exitstatus=<ExitCode.OK: 0> testsfailed=2 testscollected=252>
    â”‚      â”‚    â”” <HookCaller 'pytest_runtestloop'>
    â”‚      â”” <_pytest.config.compat.PathAwareHookProxy object at 0x74172e69f1a0>
    â”” <_pytest.config.Config object at 0x74172e7f0140>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”‚       â”” True
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”” {'session': <Session ticker_service exitstatus=<ExitCode.OK: 0> testsfailed=2 testscollected=252>}
           â”‚    â”‚         â”‚    â”‚     â”‚    â”” <member '_hookimpls' of 'HookCaller' objects>
           â”‚    â”‚         â”‚    â”‚     â”” <HookCaller 'pytest_runtestloop'>
           â”‚    â”‚         â”‚    â”” <member 'name' of 'HookCaller' objects>
           â”‚    â”‚         â”” <HookCaller 'pytest_runtestloop'>
           â”‚    â”” <member '_hookexec' of 'HookCaller' objects>
           â”” <HookCaller 'pytest_runtestloop'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           â”‚    â”‚               â”‚          â”‚        â”‚       â”” True
           â”‚    â”‚               â”‚          â”‚        â”” {'session': <Session ticker_service exitstatus=<ExitCode.OK: 0> testsfailed=2 testscollected=252>}
           â”‚    â”‚               â”‚          â”” [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/stocksadmin/.local/lib/python3.12/site-packages/_pyt...
           â”‚    â”‚               â”” 'pytest_runtestloop'
           â”‚    â”” <function _multicall at 0x74172edff380>
           â”” <_pytest.config.PytestPluginManager object at 0x74172ef31640>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          â”‚         â”‚         â”” [<Session ticker_service exitstatus=<ExitCode.OK: 0> testsfailed=2 testscollected=252>]
          â”‚         â”” <member 'function' of 'HookImpl' objects>
          â”” <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/stocksadmin/.local/lib/python3.12/site-packages/_pyte...
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    â”‚    â”‚                                        â”‚              â”” <Function test_disabled_batching_publishes_immediately>
    â”‚    â”‚                                        â”” <Function test_option_batching>
    â”‚    â”” <member 'config' of 'Node' objects>
    â”” <Function test_option_batching>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”‚       â”” True
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”” {'item': <Function test_option_batching>, 'nextitem': <Function test_disabled_batching_publishes_immediately>}
           â”‚    â”‚         â”‚    â”‚     â”‚    â”” <member '_hookimpls' of 'HookCaller' objects>
           â”‚    â”‚         â”‚    â”‚     â”” <HookCaller 'pytest_runtest_protocol'>
           â”‚    â”‚         â”‚    â”” <member 'name' of 'HookCaller' objects>
           â”‚    â”‚         â”” <HookCaller 'pytest_runtest_protocol'>
           â”‚    â”” <member '_hookexec' of 'HookCaller' objects>
           â”” <HookCaller 'pytest_runtest_protocol'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           â”‚    â”‚               â”‚          â”‚        â”‚       â”” True
           â”‚    â”‚               â”‚          â”‚        â”” {'item': <Function test_option_batching>, 'nextitem': <Function test_disabled_batching_publishes_immediately>}
           â”‚    â”‚               â”‚          â”” [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/stocksadmin/.local/lib/python3.12/site-packages/...
           â”‚    â”‚               â”” 'pytest_runtest_protocol'
           â”‚    â”” <function _multicall at 0x74172edff380>
           â”” <_pytest.config.PytestPluginManager object at 0x74172ef31640>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          â”‚         â”‚         â”” [<Function test_option_batching>, <Function test_disabled_batching_publishes_immediately>]
          â”‚         â”” <member 'function' of 'HookImpl' objects>
          â”” <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/stocksadmin/.local/lib/python3.12/site-packages/_...
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    â”‚               â”‚              â”” <Function test_disabled_batching_publishes_immediately>
    â”‚               â”” <Function test_option_batching>
    â”” <function runtestprotocol at 0x74172e97e520>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    â”‚       â”‚      â”‚               â”‚             â”” True
    â”‚       â”‚      â”‚               â”” <Function test_option_batching>
    â”‚       â”‚      â”” <function call_and_report at 0x74172e97e8e0>
    â”‚       â”” <method 'append' of 'list' objects>
    â”” [<TestReport 'tests/integration/test_tick_batcher.py::test_option_batching' when='setup' outcome='passed'>]
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
           â”‚                 â”‚     â”‚       â”” {}
           â”‚                 â”‚     â”” 'call'
           â”‚                 â”” <Function test_option_batching>
           â”” <function call_runtest_hook at 0x74172e97eac0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
           â”‚        â”” <classmethod(<function CallInfo.from_call at 0x74172e97ed40>)>
           â”” <class '_pytest.runner.CallInfo'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
            â”‚        â”‚          â”” <function call_runtest_hook.<locals>.<lambda> at 0x7417272b4c20>
            â”‚        â”” +TResult
            â”” typing.Optional
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
            â”‚          â”‚       â”” {}
            â”‚          â”” <Function test_option_batching>
            â”” <HookCaller 'pytest_runtest_call'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”‚       â”” False
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”” {'item': <Function test_option_batching>}
           â”‚    â”‚         â”‚    â”‚     â”‚    â”” <member '_hookimpls' of 'HookCaller' objects>
           â”‚    â”‚         â”‚    â”‚     â”” <HookCaller 'pytest_runtest_call'>
           â”‚    â”‚         â”‚    â”” <member 'name' of 'HookCaller' objects>
           â”‚    â”‚         â”” <HookCaller 'pytest_runtest_call'>
           â”‚    â”” <member '_hookexec' of 'HookCaller' objects>
           â”” <HookCaller 'pytest_runtest_call'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           â”‚    â”‚               â”‚          â”‚        â”‚       â”” False
           â”‚    â”‚               â”‚          â”‚        â”” {'item': <Function test_option_batching>}
           â”‚    â”‚               â”‚          â”” [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/stocksadmin/.local/lib/python3.12/site-packages/...
           â”‚    â”‚               â”” 'pytest_runtest_call'
           â”‚    â”” <function _multicall at 0x74172edff380>
           â”” <_pytest.config.PytestPluginManager object at 0x74172ef31640>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          â”‚         â”‚         â”” [<Function test_option_batching>]
          â”‚         â”” <member 'function' of 'HookImpl' objects>
          â”” <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/stocksadmin/.local/lib/python3.12/site-packages/_...
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
    â”‚    â”” <function Function.runtest at 0x74172e76d3a0>
    â”” <Function test_option_batching>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    â”‚    â”‚                                   â”” <Function test_option_batching>
    â”‚    â”” <property object at 0x74172e8e3100>
    â”” <Function test_option_batching>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”‚       â”” True
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”” {'pyfuncitem': <Function test_option_batching>}
           â”‚    â”‚         â”‚    â”‚     â”‚    â”” <member '_hookimpls' of 'HookCaller' objects>
           â”‚    â”‚         â”‚    â”‚     â”” <HookCaller 'pytest_pyfunc_call'>
           â”‚    â”‚         â”‚    â”” <member 'name' of 'HookCaller' objects>
           â”‚    â”‚         â”” <HookCaller 'pytest_pyfunc_call'>
           â”‚    â”” <member '_hookexec' of 'HookCaller' objects>
           â”” <HookCaller 'pytest_pyfunc_call'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           â”‚    â”‚               â”‚          â”‚        â”‚       â”” True
           â”‚    â”‚               â”‚          â”‚        â”” {'pyfuncitem': <Function test_option_batching>}
           â”‚    â”‚               â”‚          â”” [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/stocksadmin/.local/lib/python3.12/site-packages/...
           â”‚    â”‚               â”” 'pytest_pyfunc_call'
           â”‚    â”” <function _multicall at 0x74172edff380>
           â”” <_pytest.config.PytestPluginManager object at 0x74172ef31640>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          â”‚         â”‚         â”” [<Function test_option_batching>]
          â”‚         â”” <member 'function' of 'HookImpl' objects>
          â”” <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/stocksadmin/.local/lib/python3.12/site-packages/_...
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
             â”‚              â”” {}
             â”” <function test_option_batching at 0x741724f79f80>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 532, in inner
    _loop.run_until_complete(task)
    â”‚     â”‚                  â”” <Task pending name='Task-124' coro=<test_option_batching() running at /usr/lib/python3.12/unittest/mock.py:1407> wait_for=<Fu...
    â”‚     â”” <function BaseEventLoop.run_until_complete at 0x74172d82b1a0>
    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    â”‚    â”” <function BaseEventLoop.run_forever at 0x74172d82b100>
    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    â”‚    â”” <function BaseEventLoop._run_once at 0x74172d834f40>
    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
    â”‚      â”” <function Handle._run at 0x74172d7c1260>
    â”” <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    â”‚    â”‚            â”‚    â”‚           â”‚    â”” <member '_args' of 'Handle' objects>
    â”‚    â”‚            â”‚    â”‚           â”” <Handle Task.task_wakeup(<Future finished result=None>)>
    â”‚    â”‚            â”‚    â”” <member '_callback' of 'Handle' objects>
    â”‚    â”‚            â”” <Handle Task.task_wakeup(<Future finished result=None>)>
    â”‚    â”” <member '_context' of 'Handle' objects>
    â”” <Handle Task.task_wakeup(<Future finished result=None>)>

> File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/services/[0m[32m[1mtick_batcher.py[0m", line [33m214[0m, in [35m_flusher_loop[0m
    [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1m_flush_all[0m[1m([0m[1m)[0m
    [36m      â”‚    â”” [0m[36m[1m<function TickBatcher._flush_all at 0x741728b90900>[0m
    [36m      â”” [0m[36m[1m<app.services.tick_batcher.TickBatcher object at 0x7417271be690>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/services/[0m[32m[1mtick_batcher.py[0m", line [33m199[0m, in [35m_flush_all[0m
    [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1m_flush_options[0m[1m([0m[1m)[0m
    [36m      â”‚    â”” [0m[36m[1m<function TickBatcher._flush_options at 0x741728b90860>[0m
    [36m      â”” [0m[36m[1m<app.services.tick_batcher.TickBatcher object at 0x7417271be690>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/services/[0m[32m[1mtick_batcher.py[0m", line [33m176[0m, in [35m_flush_options[0m
    [1mmessage[0m [35m[1m=[0m [1mjson[0m[35m[1m.[0m[1mdumps[0m[1m([0m[1msnapshot[0m[35m[1m.[0m[1mto_payload[0m[1m([0m[1m)[0m[1m)[0m
    [36m          â”‚    â”‚     â”‚        â”” [0m[36m[1m<function OptionSnapshot.to_payload at 0x74172a93b240>[0m
    [36m          â”‚    â”‚     â”” [0m[36m[1mOptionSnapshot(instrument=Instrument(symbol='NIFTY', instrument_token=12345, tradingsymbol='NIFTY2512424000CE', segment='NFO-...[0m
    [36m          â”‚    â”” [0m[36m[1m<function dumps at 0x74172e98fc40>[0m
    [36m          â”” [0m[36m[1m<module 'json' from '/usr/lib/python3.12/json/__init__.py'>[0m

  File "/usr/lib/python3.12/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           â”‚                â”‚      â”” {'symbol': 'NIFTY', 'token': 12345, 'tradingsymbol': 'NIFTY2512424000CE', 'segment': 'NFO-OPT', 'exchange': 'NFO', 'strike': ...
           â”‚                â”” <function JSONEncoder.encode at 0x74172e9a8720>
           â”” <json.encoder.JSONEncoder object at 0x74172e973770>
  File "/usr/lib/python3.12/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             â”‚    â”‚          â”” {'symbol': 'NIFTY', 'token': 12345, 'tradingsymbol': 'NIFTY2512424000CE', 'segment': 'NFO-OPT', 'exchange': 'NFO', 'strike': ...
             â”‚    â”” <function JSONEncoder.iterencode at 0x74172e9a87c0>
             â”” <json.encoder.JSONEncoder object at 0x74172e973770>
  File "/usr/lib/python3.12/json/encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           â”‚           â”” {'symbol': 'NIFTY', 'token': 12345, 'tradingsymbol': 'NIFTY2512424000CE', 'segment': 'NFO-OPT', 'exchange': 'NFO', 'strike': ...
           â”” <_json.Encoder object at 0x741724d79b40>
  File "/usr/lib/python3.12/json/encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
                                      â”‚ â”‚         â”” <member '__name__' of 'getset_descriptor' objects>
                                      â”‚ â”” <attribute '__class__' of 'object' objects>
                                      â”” datetime.date(2025, 12, 9)

[31m[1mTypeError[0m:[1m Object of type date is not JSON serializable[0m
______________________ test_mixed_underlying_and_options _______________________
tests/integration/test_tick_batcher.py:247: in test_mixed_underlying_and_options
    assert batcher._total_options_flushed == 1
E   assert 0 == 1
E    +  where 0 = <app.services.tick_batcher.TickBatcher object at 0x741724eaf740>._total_options_flushed
----------------------------- Captured stdout call -----------------------------
[32m2025-11-09 06:34:52.299[0m | [1mINFO    [0m | [36mapp.services.tick_batcher[0m:[36m__init__[0m:[36m79[0m - [1mTickBatcher initialized: window=100ms, max_batch=10, enabled=True[0m
[32m2025-11-09 06:34:52.300[0m | [1mINFO    [0m | [36mapp.services.tick_batcher[0m:[36mstart[0m:[36m239[0m - [1mTickBatcher started[0m
[32m2025-11-09 06:34:52.300[0m | [1mINFO    [0m | [36mapp.services.tick_batcher[0m:[36m_flusher_loop[0m:[36m205[0m - [1mTickBatcher flusher loop started[0m
[32m2025-11-09 06:34:52.402[0m | [31m[1mERROR   [0m | [36mapp.services.tick_batcher[0m:[36m_flush_options[0m:[36m189[0m - [31m[1mFailed to flush options batch: Object of type date is not JSON serializable[0m
[32m2025-11-09 06:34:52.403[0m | [31m[1mERROR   [0m | [36mapp.services.tick_batcher[0m:[36m_flusher_loop[0m:[36m220[0m - [31m[1mError in flusher loop: Object of type date is not JSON serializable[0m
[33m[1mTraceback (most recent call last):[0m

  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pytest/__main__.py", line 5, in <module>
    raise SystemExit(pytest.console_main())
                     â”‚      â”” <function console_main at 0x74172e8dd6c0>
                     â”” <module 'pytest' from '/home/stocksadmin/.local/lib/python3.12/site-packages/pytest/__init__.py'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/config/__init__.py", line 192, in console_main
    code = main()
           â”” <function main at 0x74172e8dd580>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/config/__init__.py", line 169, in main
    ret: Union[ExitCode, int] = config.hook.pytest_cmdline_main(
         â”‚     â”‚                â”‚      â”‚    â”” <HookCaller 'pytest_cmdline_main'>
         â”‚     â”‚                â”‚      â”” <_pytest.config.compat.PathAwareHookProxy object at 0x74172e69f1a0>
         â”‚     â”‚                â”” <_pytest.config.Config object at 0x74172e7f0140>
         â”‚     â”” <enum 'ExitCode'>
         â”” typing.Union
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”‚       â”” True
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”” {'config': <_pytest.config.Config object at 0x74172e7f0140>}
           â”‚    â”‚         â”‚    â”‚     â”‚    â”” <member '_hookimpls' of 'HookCaller' objects>
           â”‚    â”‚         â”‚    â”‚     â”” <HookCaller 'pytest_cmdline_main'>
           â”‚    â”‚         â”‚    â”” <member 'name' of 'HookCaller' objects>
           â”‚    â”‚         â”” <HookCaller 'pytest_cmdline_main'>
           â”‚    â”” <member '_hookexec' of 'HookCaller' objects>
           â”” <HookCaller 'pytest_cmdline_main'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           â”‚    â”‚               â”‚          â”‚        â”‚       â”” True
           â”‚    â”‚               â”‚          â”‚        â”” {'config': <_pytest.config.Config object at 0x74172e7f0140>}
           â”‚    â”‚               â”‚          â”” [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/stocksadmin/.local/lib/python3.12/site-packages/_pyt...
           â”‚    â”‚               â”” 'pytest_cmdline_main'
           â”‚    â”” <function _multicall at 0x74172edff380>
           â”” <_pytest.config.PytestPluginManager object at 0x74172ef31640>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          â”‚         â”‚         â”” [<_pytest.config.Config object at 0x74172e7f0140>]
          â”‚         â”” <member 'function' of 'HookImpl' objects>
          â”” <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/stocksadmin/.local/lib/python3.12/site-packages/_pyte...
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/main.py", line 318, in pytest_cmdline_main
    return wrap_session(config, _main)
           â”‚            â”‚       â”” <function _main at 0x74172e97f380>
           â”‚            â”” <_pytest.config.Config object at 0x74172e7f0140>
           â”” <function wrap_session at 0x74172e97f2e0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/main.py", line 271, in wrap_session
    session.exitstatus = doit(config, session) or 0
    â”‚       â”‚            â”‚    â”‚       â”” <Session ticker_service exitstatus=<ExitCode.OK: 0> testsfailed=3 testscollected=252>
    â”‚       â”‚            â”‚    â”” <_pytest.config.Config object at 0x74172e7f0140>
    â”‚       â”‚            â”” <function _main at 0x74172e97f380>
    â”‚       â”” <ExitCode.OK: 0>
    â”” <Session ticker_service exitstatus=<ExitCode.OK: 0> testsfailed=3 testscollected=252>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/main.py", line 325, in _main
    config.hook.pytest_runtestloop(session=session)
    â”‚      â”‚    â”‚                          â”” <Session ticker_service exitstatus=<ExitCode.OK: 0> testsfailed=3 testscollected=252>
    â”‚      â”‚    â”” <HookCaller 'pytest_runtestloop'>
    â”‚      â”” <_pytest.config.compat.PathAwareHookProxy object at 0x74172e69f1a0>
    â”” <_pytest.config.Config object at 0x74172e7f0140>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”‚       â”” True
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”” {'session': <Session ticker_service exitstatus=<ExitCode.OK: 0> testsfailed=3 testscollected=252>}
           â”‚    â”‚         â”‚    â”‚     â”‚    â”” <member '_hookimpls' of 'HookCaller' objects>
           â”‚    â”‚         â”‚    â”‚     â”” <HookCaller 'pytest_runtestloop'>
           â”‚    â”‚         â”‚    â”” <member 'name' of 'HookCaller' objects>
           â”‚    â”‚         â”” <HookCaller 'pytest_runtestloop'>
           â”‚    â”” <member '_hookexec' of 'HookCaller' objects>
           â”” <HookCaller 'pytest_runtestloop'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           â”‚    â”‚               â”‚          â”‚        â”‚       â”” True
           â”‚    â”‚               â”‚          â”‚        â”” {'session': <Session ticker_service exitstatus=<ExitCode.OK: 0> testsfailed=3 testscollected=252>}
           â”‚    â”‚               â”‚          â”” [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/stocksadmin/.local/lib/python3.12/site-packages/_pyt...
           â”‚    â”‚               â”” 'pytest_runtestloop'
           â”‚    â”” <function _multicall at 0x74172edff380>
           â”” <_pytest.config.PytestPluginManager object at 0x74172ef31640>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          â”‚         â”‚         â”” [<Session ticker_service exitstatus=<ExitCode.OK: 0> testsfailed=3 testscollected=252>]
          â”‚         â”” <member 'function' of 'HookImpl' objects>
          â”” <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/stocksadmin/.local/lib/python3.12/site-packages/_pyte...
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/main.py", line 350, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    â”‚    â”‚                                        â”‚              â”” <Function test_tick_processor_integration>
    â”‚    â”‚                                        â”” <Function test_mixed_underlying_and_options>
    â”‚    â”” <member 'config' of 'Node' objects>
    â”” <Function test_mixed_underlying_and_options>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”‚       â”” True
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”” {'item': <Function test_mixed_underlying_and_options>, 'nextitem': <Function test_tick_processor_integration>}
           â”‚    â”‚         â”‚    â”‚     â”‚    â”” <member '_hookimpls' of 'HookCaller' objects>
           â”‚    â”‚         â”‚    â”‚     â”” <HookCaller 'pytest_runtest_protocol'>
           â”‚    â”‚         â”‚    â”” <member 'name' of 'HookCaller' objects>
           â”‚    â”‚         â”” <HookCaller 'pytest_runtest_protocol'>
           â”‚    â”” <member '_hookexec' of 'HookCaller' objects>
           â”” <HookCaller 'pytest_runtest_protocol'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           â”‚    â”‚               â”‚          â”‚        â”‚       â”” True
           â”‚    â”‚               â”‚          â”‚        â”” {'item': <Function test_mixed_underlying_and_options>, 'nextitem': <Function test_tick_processor_integration>}
           â”‚    â”‚               â”‚          â”” [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/stocksadmin/.local/lib/python3.12/site-packages/...
           â”‚    â”‚               â”” 'pytest_runtest_protocol'
           â”‚    â”” <function _multicall at 0x74172edff380>
           â”” <_pytest.config.PytestPluginManager object at 0x74172ef31640>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          â”‚         â”‚         â”” [<Function test_mixed_underlying_and_options>, <Function test_tick_processor_integration>]
          â”‚         â”” <member 'function' of 'HookImpl' objects>
          â”” <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/stocksadmin/.local/lib/python3.12/site-packages/_...
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/runner.py", line 114, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    â”‚               â”‚              â”” <Function test_tick_processor_integration>
    â”‚               â”” <Function test_mixed_underlying_and_options>
    â”” <function runtestprotocol at 0x74172e97e520>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/runner.py", line 133, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    â”‚       â”‚      â”‚               â”‚             â”” True
    â”‚       â”‚      â”‚               â”” <Function test_mixed_underlying_and_options>
    â”‚       â”‚      â”” <function call_and_report at 0x74172e97e8e0>
    â”‚       â”” <method 'append' of 'list' objects>
    â”” [<TestReport 'tests/integration/test_tick_batcher.py::test_mixed_underlying_and_options' when='setup' outcome='passed'>]
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/runner.py", line 222, in call_and_report
    call = call_runtest_hook(item, when, **kwds)
           â”‚                 â”‚     â”‚       â”” {}
           â”‚                 â”‚     â”” 'call'
           â”‚                 â”” <Function test_mixed_underlying_and_options>
           â”” <function call_runtest_hook at 0x74172e97eac0>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/runner.py", line 261, in call_runtest_hook
    return CallInfo.from_call(
           â”‚        â”” <classmethod(<function CallInfo.from_call at 0x74172e97ed40>)>
           â”” <class '_pytest.runner.CallInfo'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/runner.py", line 341, in from_call
    result: Optional[TResult] = func()
            â”‚        â”‚          â”” <function call_runtest_hook.<locals>.<lambda> at 0x74172d20e980>
            â”‚        â”” +TResult
            â”” typing.Optional
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/runner.py", line 262, in <lambda>
    lambda: ihook(item=item, **kwds), when=when, reraise=reraise
            â”‚          â”‚       â”” {}
            â”‚          â”” <Function test_mixed_underlying_and_options>
            â”” <HookCaller 'pytest_runtest_call'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”‚       â”” False
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”” {'item': <Function test_mixed_underlying_and_options>}
           â”‚    â”‚         â”‚    â”‚     â”‚    â”” <member '_hookimpls' of 'HookCaller' objects>
           â”‚    â”‚         â”‚    â”‚     â”” <HookCaller 'pytest_runtest_call'>
           â”‚    â”‚         â”‚    â”” <member 'name' of 'HookCaller' objects>
           â”‚    â”‚         â”” <HookCaller 'pytest_runtest_call'>
           â”‚    â”” <member '_hookexec' of 'HookCaller' objects>
           â”” <HookCaller 'pytest_runtest_call'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           â”‚    â”‚               â”‚          â”‚        â”‚       â”” False
           â”‚    â”‚               â”‚          â”‚        â”” {'item': <Function test_mixed_underlying_and_options>}
           â”‚    â”‚               â”‚          â”” [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/stocksadmin/.local/lib/python3.12/site-packages/...
           â”‚    â”‚               â”” 'pytest_runtest_call'
           â”‚    â”” <function _multicall at 0x74172edff380>
           â”” <_pytest.config.PytestPluginManager object at 0x74172ef31640>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          â”‚         â”‚         â”” [<Function test_mixed_underlying_and_options>]
          â”‚         â”” <member 'function' of 'HookImpl' objects>
          â”” <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/stocksadmin/.local/lib/python3.12/site-packages/_...
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/runner.py", line 169, in pytest_runtest_call
    item.runtest()
    â”‚    â”” <function Function.runtest at 0x74172e76d3a0>
    â”” <Function test_mixed_underlying_and_options>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/python.py", line 1792, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    â”‚    â”‚                                   â”” <Function test_mixed_underlying_and_options>
    â”‚    â”” <property object at 0x74172e8e3100>
    â”” <Function test_mixed_underlying_and_options>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”‚       â”” True
           â”‚    â”‚         â”‚    â”‚     â”‚    â”‚                  â”” {'pyfuncitem': <Function test_mixed_underlying_and_options>}
           â”‚    â”‚         â”‚    â”‚     â”‚    â”” <member '_hookimpls' of 'HookCaller' objects>
           â”‚    â”‚         â”‚    â”‚     â”” <HookCaller 'pytest_pyfunc_call'>
           â”‚    â”‚         â”‚    â”” <member 'name' of 'HookCaller' objects>
           â”‚    â”‚         â”” <HookCaller 'pytest_pyfunc_call'>
           â”‚    â”” <member '_hookexec' of 'HookCaller' objects>
           â”” <HookCaller 'pytest_pyfunc_call'>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           â”‚    â”‚               â”‚          â”‚        â”‚       â”” True
           â”‚    â”‚               â”‚          â”‚        â”” {'pyfuncitem': <Function test_mixed_underlying_and_options>}
           â”‚    â”‚               â”‚          â”” [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/stocksadmin/.local/lib/python3.12/site-packages/...
           â”‚    â”‚               â”” 'pytest_pyfunc_call'
           â”‚    â”” <function _multicall at 0x74172edff380>
           â”” <_pytest.config.PytestPluginManager object at 0x74172ef31640>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          â”‚         â”‚         â”” [<Function test_mixed_underlying_and_options>]
          â”‚         â”” <member 'function' of 'HookImpl' objects>
          â”” <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/stocksadmin/.local/lib/python3.12/site-packages/_...
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/_pytest/python.py", line 194, in pytest_pyfunc_call
    result = testfunction(**testargs)
             â”‚              â”” {}
             â”” <function test_mixed_underlying_and_options at 0x741724e23380>
  File "/home/stocksadmin/.local/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 532, in inner
    _loop.run_until_complete(task)
    â”‚     â”‚                  â”” <Task pending name='Task-129' coro=<test_mixed_underlying_and_options() running at /usr/lib/python3.12/unittest/mock.py:1407>...
    â”‚     â”” <function BaseEventLoop.run_until_complete at 0x74172d82b1a0>
    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
    â”‚    â”” <function BaseEventLoop.run_forever at 0x74172d82b100>
    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
    â”‚    â”” <function BaseEventLoop._run_once at 0x74172d834f40>
    â”” <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
    â”‚      â”” <function Handle._run at 0x74172d7c1260>
    â”” <Handle Task.task_wakeup(<Future finished result=None>)>
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    â”‚    â”‚            â”‚    â”‚           â”‚    â”” <member '_args' of 'Handle' objects>
    â”‚    â”‚            â”‚    â”‚           â”” <Handle Task.task_wakeup(<Future finished result=None>)>
    â”‚    â”‚            â”‚    â”” <member '_callback' of 'Handle' objects>
    â”‚    â”‚            â”” <Handle Task.task_wakeup(<Future finished result=None>)>
    â”‚    â”” <member '_context' of 'Handle' objects>
    â”” <Handle Task.task_wakeup(<Future finished result=None>)>

> File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/services/[0m[32m[1mtick_batcher.py[0m", line [33m214[0m, in [35m_flusher_loop[0m
    [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1m_flush_all[0m[1m([0m[1m)[0m
    [36m      â”‚    â”” [0m[36m[1m<function TickBatcher._flush_all at 0x741728b90900>[0m
    [36m      â”” [0m[36m[1m<app.services.tick_batcher.TickBatcher object at 0x741724eaf740>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/services/[0m[32m[1mtick_batcher.py[0m", line [33m199[0m, in [35m_flush_all[0m
    [35m[1mawait[0m [1mself[0m[35m[1m.[0m[1m_flush_options[0m[1m([0m[1m)[0m
    [36m      â”‚    â”” [0m[36m[1m<function TickBatcher._flush_options at 0x741728b90860>[0m
    [36m      â”” [0m[36m[1m<app.services.tick_batcher.TickBatcher object at 0x741724eaf740>[0m

  File "[32m/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/services/[0m[32m[1mtick_batcher.py[0m", line [33m176[0m, in [35m_flush_options[0m
    [1mmessage[0m [35m[1m=[0m [1mjson[0m[35m[1m.[0m[1mdumps[0m[1m([0m[1msnapshot[0m[35m[1m.[0m[1mto_payload[0m[1m([0m[1m)[0m[1m)[0m
    [36m          â”‚    â”‚     â”‚        â”” [0m[36m[1m<function OptionSnapshot.to_payload at 0x74172a93b240>[0m
    [36m          â”‚    â”‚     â”” [0m[36m[1mOptionSnapshot(instrument=Instrument(symbol='NIFTY', instrument_token=12345, tradingsymbol='NIFTY2512424000CE', segment='NFO-...[0m
    [36m          â”‚    â”” [0m[36m[1m<function dumps at 0x74172e98fc40>[0m
    [36m          â”” [0m[36m[1m<module 'json' from '/usr/lib/python3.12/json/__init__.py'>[0m

  File "/usr/lib/python3.12/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           â”‚                â”‚      â”” {'symbol': 'NIFTY', 'token': 12345, 'tradingsymbol': 'NIFTY2512424000CE', 'segment': 'NFO-OPT', 'exchange': 'NFO', 'strike': ...
           â”‚                â”” <function JSONEncoder.encode at 0x74172e9a8720>
           â”” <json.encoder.JSONEncoder object at 0x74172e973770>
  File "/usr/lib/python3.12/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
             â”‚    â”‚          â”” {'symbol': 'NIFTY', 'token': 12345, 'tradingsymbol': 'NIFTY2512424000CE', 'segment': 'NFO-OPT', 'exchange': 'NFO', 'strike': ...
             â”‚    â”” <function JSONEncoder.iterencode at 0x74172e9a87c0>
             â”” <json.encoder.JSONEncoder object at 0x74172e973770>
  File "/usr/lib/python3.12/json/encoder.py", line 258, in iterencode
    return _iterencode(o, 0)
           â”‚           â”” {'symbol': 'NIFTY', 'token': 12345, 'tradingsymbol': 'NIFTY2512424000CE', 'segment': 'NFO-OPT', 'exchange': 'NFO', 'strike': ...
           â”” <_json.Encoder object at 0x741724e3cd60>
  File "/usr/lib/python3.12/json/encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
                                      â”‚ â”‚         â”” <member '__name__' of 'getset_descriptor' objects>
                                      â”‚ â”” <attribute '__class__' of 'object' objects>
                                      â”” datetime.date(2025, 12, 9)

[31m[1mTypeError[0m:[1m Object of type date is not JSON serializable[0m
_______________________ test_underlying_tick_processing ________________________
/home/stocksadmin/.local/lib/python3.12/site-packages/pytest_asyncio/plugin.py:532: in inner
    _loop.run_until_complete(task)
/usr/lib/python3.12/asyncio/base_events.py:687: in run_until_complete
    return future.result()
/usr/lib/python3.12/unittest/mock.py:1404: in patched
    with self.decoration_helper(patched,
/usr/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
/usr/lib/python3.12/unittest/mock.py:1369: in decoration_helper
    arg = exit_stack.enter_context(patching)
/usr/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.services.tick_processor' from '/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/services/tick_processor.py'> does not have the attribute 'publish_underlying_bar'
_________________________ test_option_tick_processing __________________________
/home/stocksadmin/.local/lib/python3.12/site-packages/pytest_asyncio/plugin.py:532: in inner
    _loop.run_until_complete(task)
/usr/lib/python3.12/asyncio/base_events.py:687: in run_until_complete
    return future.result()
/usr/lib/python3.12/unittest/mock.py:1404: in patched
    with self.decoration_helper(patched,
/usr/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
/usr/lib/python3.12/unittest/mock.py:1369: in decoration_helper
    arg = exit_stack.enter_context(patching)
/usr/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.services.tick_processor' from '/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/services/tick_processor.py'> does not have the attribute 'publish_underlying_bar'
_________________________ test_market_depth_extraction _________________________
/home/stocksadmin/.local/lib/python3.12/site-packages/pytest_asyncio/plugin.py:532: in inner
    _loop.run_until_complete(task)
/usr/lib/python3.12/asyncio/base_events.py:687: in run_until_complete
    return future.result()
/usr/lib/python3.12/unittest/mock.py:1404: in patched
    with self.decoration_helper(patched,
/usr/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
/usr/lib/python3.12/unittest/mock.py:1369: in decoration_helper
    arg = exit_stack.enter_context(patching)
/usr/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.services.tick_processor' from '/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/services/tick_processor.py'> does not have the attribute 'publish_underlying_bar'
_____________________ test_tick_processor_state_management _____________________
/home/stocksadmin/.local/lib/python3.12/site-packages/pytest_asyncio/plugin.py:532: in inner
    _loop.run_until_complete(task)
/usr/lib/python3.12/asyncio/base_events.py:687: in run_until_complete
    return future.result()
/usr/lib/python3.12/unittest/mock.py:1404: in patched
    with self.decoration_helper(patched,
/usr/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
/usr/lib/python3.12/unittest/mock.py:1369: in decoration_helper
    arg = exit_stack.enter_context(patching)
/usr/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.services.tick_processor' from '/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/services/tick_processor.py'> does not have the attribute 'publish_underlying_bar'
__________________________ test_tick_processor_stats ___________________________
/home/stocksadmin/.local/lib/python3.12/site-packages/pytest_asyncio/plugin.py:532: in inner
    _loop.run_until_complete(task)
/usr/lib/python3.12/asyncio/base_events.py:687: in run_until_complete
    return future.result()
/usr/lib/python3.12/unittest/mock.py:1404: in patched
    with self.decoration_helper(patched,
/usr/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
/usr/lib/python3.12/unittest/mock.py:1369: in decoration_helper
    arg = exit_stack.enter_context(patching)
/usr/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
/usr/lib/python3.12/unittest/mock.py:1458: in __enter__
    original, local = self.get_original()
/usr/lib/python3.12/unittest/mock.py:1431: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.services.tick_processor' from '/mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/services/tick_processor.py'> does not have the attribute 'publish_underlying_bar'
____________________ test_websocket_connection_established _____________________
tests/integration/test_websocket_basic.py:53: in test_websocket_connection_established
    await connection_manager.connect(
E   TypeError: ConnectionManager.connect() missing 1 required positional argument: 'token_hash'
______________________ test_websocket_graceful_disconnect ______________________
tests/integration/test_websocket_basic.py:78: in test_websocket_graceful_disconnect
    await connection_manager.connect("conn_1", mock_websocket, "user_123")
E   TypeError: ConnectionManager.connect() missing 1 required positional argument: 'token_hash'
______________________ test_multiple_connections_isolated ______________________
tests/integration/test_websocket_basic.py:107: in test_multiple_connections_isolated
    await connection_manager.connect("conn_1", ws1, "user_1")
E   TypeError: ConnectionManager.connect() missing 1 required positional argument: 'token_hash'
________________________ test_subscribe_to_instruments _________________________
tests/integration/test_websocket_basic.py:136: in test_subscribe_to_instruments
    await connection_manager.connect("conn_1", mock_websocket, "user_123")
E   TypeError: ConnectionManager.connect() missing 1 required positional argument: 'token_hash'
__________________________ test_subscribe_idempotent ___________________________
tests/integration/test_websocket_basic.py:163: in test_subscribe_idempotent
    await connection_manager.connect("conn_1", mock_websocket, "user_123")
E   TypeError: ConnectionManager.connect() missing 1 required positional argument: 'token_hash'
______________________ test_unsubscribe_from_instruments _______________________
tests/integration/test_websocket_basic.py:186: in test_unsubscribe_from_instruments
    await connection_manager.connect("conn_1", mock_websocket, "user_123")
E   TypeError: ConnectionManager.connect() missing 1 required positional argument: 'token_hash'
_________________________ test_subscription_filtering __________________________
tests/integration/test_websocket_basic.py:219: in test_subscription_filtering
    await connection_manager.connect("conn_1", ws1, "user_1")
E   TypeError: ConnectionManager.connect() missing 1 required positional argument: 'token_hash'
______________ test_connection_cleanup_removes_all_subscriptions _______________
tests/integration/test_websocket_basic.py:306: in test_connection_cleanup_removes_all_subscriptions
    await connection_manager.connect("conn_1", mock_websocket, "user_123")
E   TypeError: ConnectionManager.connect() missing 1 required positional argument: 'token_hash'
_____________________ test_multiple_subscribers_same_token _____________________
tests/integration/test_websocket_basic.py:338: in test_multiple_subscribers_same_token
    await connection_manager.connect("conn_1", ws1, "user_1")
E   TypeError: ConnectionManager.connect() missing 1 required positional argument: 'token_hash'
_____________ test_partial_disconnect_preserves_other_subscribers ______________
tests/integration/test_websocket_basic.py:370: in test_partial_disconnect_preserves_other_subscribers
    await connection_manager.connect("conn_1", ws1, "user_1")
E   TypeError: ConnectionManager.connect() missing 1 required positional argument: 'token_hash'
___________________ test_circuit_breaker_recovers_to_closed ____________________
tests/unit/test_order_executor.py:207: in test_circuit_breaker_recovers_to_closed
    assert circuit.state == CircuitState.CLOSED, "Should close after success in HALF_OPEN"
E   AssertionError: Should close after success in HALF_OPEN
E   assert <CircuitState.HALF_OPEN: 'half_open'> == <CircuitState.CLOSED: 'closed'>
E     - closed
E     + half_open
----------------------------- Captured stdout call -----------------------------
[32m2025-11-09 06:35:56.365[0m | [31m[1mERROR   [0m | [36mapp.order_executor[0m:[36mrecord_failure[0m:[36m149[0m - [31m[1mCircuit breaker transitioning to OPEN state[0m
[32m2025-11-09 06:35:57.866[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36mcan_execute[0m:[36m115[0m - [1mCircuit breaker transitioning to HALF_OPEN state[0m
______________________ test_task_cleanup_on_max_capacity _______________________
tests/unit/test_order_executor.py:239: in test_task_cleanup_on_max_capacity
    if len(small_executor._tasks) > small_executor.max_tasks:
E   AttributeError: 'OrderExecutor' object has no attribute 'max_tasks'. Did you mean: '_max_tasks'?
________________ test_idempotency_prevents_duplicate_submission ________________
tests/unit/test_order_executor.py:272: in test_idempotency_prevents_duplicate_submission
    task_id_1 = await executor.submit_task(
E   TypeError: OrderExecutor.submit_task() got an unexpected keyword argument 'idempotency_key'
_______________________ test_concurrent_task_submission ________________________
tests/unit/test_order_executor.py:363: in test_concurrent_task_submission
    assert len(set(task_ids)) == 20, "All task IDs should be unique"
E   TypeError: unhashable type: 'OrderTask'
----------------------------- Captured stdout call -----------------------------
[32m2025-11-09 06:35:57.932[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 409adadd-6d22-4927-8215-7a50a74e2087 for place_order[0m
[32m2025-11-09 06:35:57.933[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 5f7b7a79-6d2c-4364-b923-b873ceed6658 for place_order[0m
[32m2025-11-09 06:35:57.933[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task cb489f09-068b-4018-a5f6-5dc7e04763e1 for place_order[0m
[32m2025-11-09 06:35:57.933[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 62c70304-d243-46e3-aa4f-23e477d7ca0a for place_order[0m
[32m2025-11-09 06:35:57.934[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 999062bf-62fb-4921-abb0-cce4584743be for place_order[0m
[32m2025-11-09 06:35:57.934[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task c927a27f-eb27-4d4f-832a-c5fa7fa8006d for place_order[0m
[32m2025-11-09 06:35:57.934[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task f70b9f41-530c-40ee-ad1a-c092de201461 for place_order[0m
[32m2025-11-09 06:35:57.934[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 95fa5516-1d03-47c0-961b-48782f7bf68e for place_order[0m
[32m2025-11-09 06:35:57.935[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 274cb5ca-8ae3-4865-b370-69453903c3cf for place_order[0m
[32m2025-11-09 06:35:57.935[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 899931fd-3de5-4a85-9251-617070424aac for place_order[0m
[32m2025-11-09 06:35:57.935[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task e899a49c-330d-4af0-b8e4-8cbb9c57603d for place_order[0m
[32m2025-11-09 06:35:57.936[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task b46c090e-3491-46a9-bda4-7e993e0a7513 for place_order[0m
[32m2025-11-09 06:35:57.936[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 59ce4551-530d-4844-8213-7d0eb83e1f9f for place_order[0m
[32m2025-11-09 06:35:57.936[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task ffbdd943-ace2-4351-8ad4-8a411bb7c18b for place_order[0m
[32m2025-11-09 06:35:57.936[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task bb18c4f3-e9b9-4aab-b290-39e7fdb80c51 for place_order[0m
[32m2025-11-09 06:35:57.937[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 3b744e79-296f-4c17-9f8c-d33afe78fe57 for place_order[0m
[32m2025-11-09 06:35:57.937[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 7a0576ed-a9f2-45be-a5fb-087cf551ce15 for place_order[0m
[32m2025-11-09 06:35:57.937[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 3be18baf-141b-430d-8f2a-194a63025e76 for place_order[0m
[32m2025-11-09 06:35:57.937[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 1da1e2ef-2115-4910-9b13-b02f94d0fe59 for place_order[0m
[32m2025-11-09 06:35:57.938[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 851e2379-369f-45e9-9265-0eebab75fbcb for place_order[0m
_____________________________ test_get_task_status _____________________________
tests/unit/test_order_executor.py:421: in test_get_task_status
    task = executor.get_task(task_id)
app/order_executor.py:426: in get_task
    return self._tasks.get(task_id)
E   TypeError: unhashable type: 'OrderTask'
----------------------------- Captured stdout call -----------------------------
[32m2025-11-09 06:35:57.958[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 2e18f99f-9dc3-4cf6-b036-e30bd662b8eb for place_order[0m
_______________________________ test_list_tasks ________________________________
tests/unit/test_order_executor.py:453: in test_list_tasks
    assert len(all_tasks) >= 5
E   AssertionError: assert 1 >= 5
E    +  where 1 = len([OrderTask(task_id='a1517e10-54d8-464d-8258-7495a5be7740', idempotency_key='9b0b02ede403ccf7b2ccc0c05225177ad3a0fe671c9883412f453b62f506fe14', operation='place_order', params={'symbol': 'STOCK0'}, status=<TaskStatus.PENDING: 'pending'>, attempts=0, max_attempts=5, created_at=datetime.datetime(2025, 11, 9, 6, 35, 57, 991434, tzinfo=datetime.timezone.utc), updated_at=datetime.datetime(2025, 11, 9, 6, 35, 57, 991437, tzinfo=datetime.timezone.utc), last_error=None, result=None, account_id='primary')])
----------------------------- Captured stdout call -----------------------------
[32m2025-11-09 06:35:57.991[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task a1517e10-54d8-464d-8258-7495a5be7740 for place_order[0m
[32m2025-11-09 06:35:57.991[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m217[0m - [1mIdempotent task found for place_order: a1517e10-54d8-464d-8258-7495a5be7740 (status=TaskStatus.PENDING)[0m
[32m2025-11-09 06:35:57.992[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m217[0m - [1mIdempotent task found for place_order: a1517e10-54d8-464d-8258-7495a5be7740 (status=TaskStatus.PENDING)[0m
[32m2025-11-09 06:35:57.992[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m217[0m - [1mIdempotent task found for place_order: a1517e10-54d8-464d-8258-7495a5be7740 (status=TaskStatus.PENDING)[0m
[32m2025-11-09 06:35:57.992[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m217[0m - [1mIdempotent task found for place_order: a1517e10-54d8-464d-8258-7495a5be7740 (status=TaskStatus.PENDING)[0m
_______________________ test_get_all_tasks_returns_list ________________________
tests/unit/test_order_executor_simple.py:102: in test_get_all_tasks_returns_list
    assert len(all_tasks) >= 3, f"Expected at least 3 tasks, got {len(all_tasks)}"
E   AssertionError: Expected at least 3 tasks, got 1
E   assert 1 >= 3
E    +  where 1 = len([OrderTask(task_id='66cf3ac9-7c52-48de-af14-8da07f9c3337', idempotency_key='9b0b02ede403ccf7b2ccc0c05225177ad3a0fe671c9883412f453b62f506fe14', operation='place_order', params={'symbol': 'STOCK0', 'qty': 10}, status=<TaskStatus.PENDING: 'pending'>, attempts=0, max_attempts=5, created_at=datetime.datetime(2025, 11, 9, 6, 35, 58, 154162, tzinfo=datetime.timezone.utc), updated_at=datetime.datetime(2025, 11, 9, 6, 35, 58, 154163, tzinfo=datetime.timezone.utc), last_error=None, result=None, account_id='primary')])
----------------------------- Captured stdout call -----------------------------
[32m2025-11-09 06:35:58.154[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 66cf3ac9-7c52-48de-af14-8da07f9c3337 for place_order[0m
[32m2025-11-09 06:35:58.154[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m217[0m - [1mIdempotent task found for place_order: 66cf3ac9-7c52-48de-af14-8da07f9c3337 (status=TaskStatus.PENDING)[0m
[32m2025-11-09 06:35:58.154[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m217[0m - [1mIdempotent task found for place_order: 66cf3ac9-7c52-48de-af14-8da07f9c3337 (status=TaskStatus.PENDING)[0m
____________________ test_get_all_tasks_with_status_filter _____________________
tests/unit/test_order_executor_simple.py:131: in test_get_all_tasks_with_status_filter
    assert len(pending_tasks) >= 1, "Should have at least 1 pending task"
E   AssertionError: Should have at least 1 pending task
E   assert 0 >= 1
E    +  where 0 = len([])
----------------------------- Captured stdout call -----------------------------
[32m2025-11-09 06:35:58.160[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m237[0m - [1mSubmitted new task 6f135a07-0330-4aa5-89ed-06ac61f12bd1 for place_order[0m
[32m2025-11-09 06:35:58.161[0m | [1mINFO    [0m | [36mapp.order_executor[0m:[36msubmit_task[0m:[36m217[0m - [1mIdempotent task found for place_order: 6f135a07-0330-4aa5-89ed-06ac61f12bd1 (status=TaskStatus.PENDING)[0m
________ test_generate_idempotency_key_different_for_different_symbols _________
tests/unit/test_order_executor_simple.py:224: in test_generate_idempotency_key_different_for_different_symbols
    assert key1 != key2, f"Different symbols should generate different keys:\nkey1={key1}\nkey2={key2}"
E   AssertionError: Different symbols should generate different keys:
E     key1=9b0b02ede403ccf7b2ccc0c05225177ad3a0fe671c9883412f453b62f506fe14
E     key2=9b0b02ede403ccf7b2ccc0c05225177ad3a0fe671c9883412f453b62f506fe14
E   assert '9b0b02ede403ccf7b2ccc0c05225177ad3a0fe671c9883412f453b62f506fe14' != '9b0b02ede403ccf7b2ccc0c05225177ad3a0fe671c9883412f453b62f506fe14'
=============================== warnings summary ===============================
../../../../../home/stocksadmin/.local/lib/python3.12/site-packages/pytz/tzinfo.py:27
  /home/stocksadmin/.local/lib/python3.12/site-packages/pytz/tzinfo.py:27: DeprecationWarning: datetime.datetime.utcfromtimestamp() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.fromtimestamp(timestamp, datetime.UTC).
    _epoch = datetime.utcfromtimestamp(0)

../../../../../home/stocksadmin/.local/lib/python3.12/site-packages/pydantic/fields.py:799: 13 warnings
  /home/stocksadmin/.local/lib/python3.12/site-packages/pydantic/fields.py:799: PydanticDeprecatedSince20: Using extra keyword arguments on `Field` is deprecated and will be removed. Use `json_schema_extra` instead. (Extra keys: 'env'). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    warn(

../../../../../home/stocksadmin/.local/lib/python3.12/site-packages/pydantic/_internal/_config.py:268
../../../../../home/stocksadmin/.local/lib/python3.12/site-packages/pydantic/_internal/_config.py:268
  /home/stocksadmin/.local/lib/python3.12/site-packages/pydantic/_internal/_config.py:268: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

tests/integration/test_api_endpoints.py::test_health_endpoint
  /mnt/stocksblitz-data/Quantagro/tradingview-viz/ticker_service/app/redis_client.py:66: DeprecationWarning: Call to deprecated close. (Use aclose() instead) -- Deprecated since version 5.0.0.
    await client.close()

tests/integration/test_api_endpoints.py::test_health_endpoint
tests/integration/test_api_endpoints.py::test_subscriptions_list
tests/integration/test_api_endpoints.py::test_subscriptions_pagination
  /home/stocksadmin/.local/lib/python3.12/site-packages/psycopg_pool/pool_async.py:141: RuntimeWarning: opening the async pool AsyncConnectionPool in the constructor is deprecated and will not be supported anymore in a future release. Please use `await pool.open()`, or use the pool as context manager using: `async with AsyncConnectionPool(...) as pool: `...
    warnings.warn(

tests/unit/test_task_monitor.py::test_task_monitor_cancelled_task
  /usr/lib/python3.12/asyncio/events.py:88: RuntimeWarning: coroutine 'test_task_monitor_cancelled_task.<locals>.long_running_task' was never awaited
    self._context.run(self._callback, *self._args)
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform linux, python 3.12.3-final-0 -----------
Name                                      Stmts   Miss  Cover   Missing
-----------------------------------------------------------------------
app/__init__.py                               0      0   100%
app/account_store.py                        178    153    14%   25-39, 43-45, 49-55, 59-90, 94-95, 111-153, 157-189, 193-235, 252-324, 328-352, 356-367, 376-378, 385-391
app/accounts.py                             310    246    21%   25-28, 32-40, 56-83, 96-115, 128-159, 163-214, 227-230, 233-236, 241-242, 245-246, 249-251, 262-312, 320-322, 333-387, 389, 392, 395, 411-422, 425-433, 436-443, 446-460, 463, 482-541, 554-556
app/api_models.py                           197      6    97%   254-270, 275-277
app/auth.py                                  16      0   100%
app/backpressure_monitor.py                 148    148     0%   6-354
app/batch_orders.py                         111     71    36%   58-71, 87-201, 214-236
app/config.py                               164     13    92%   214-215, 223, 231, 239, 247, 255, 263, 271, 279, 287, 295, 303
app/crypto.py                                33      4    88%   55, 104-106
app/database_loader.py                       97     63    35%   75-90, 113-207, 217-232
app/dependencies.py                          28     28     0%   16-170
app/generator.py                            417    327    22%   33-37, 66-68, 118-219, 225-264, 268, 279-286, 304-307, 316, 328, 340-347, 357-389, 395-398, 401, 404-413, 433-437, 447-468, 471-480, 489-508, 511-540, 543-566, 569-581, 583-603, 613-653, 661-704, 716-731, 737, 753-756, 763-766
app/greeks_calculator.py                    163    112    31%   23-33, 94, 135-166, 192-256, 291-390, 438-537
app/historical_greeks.py                    192    169    12%   50-52, 82-120, 124, 130-147, 164-205, 214-249, 253-300, 310-328, 338-398, 407-424, 428-442
app/instrument_registry.py                  254    197    22%   16-17, 40, 71-86, 89-95, 98-99, 102-114, 117, 121-150, 153-212, 223-270, 273-282, 285-341, 343-345, 349-377, 380-442, 461-487
app/jwt_auth.py                             233    179    23%   43-53, 74-88, 101-112, 145-146, 163-164, 172, 182-212, 233-253, 271-305, 321-362, 380-401, 420, 455-467, 483-505, 531-539, 556-579, 599-617, 639-664, 686-696
app/kite/__init__.py                          0      0   100%
app/kite/client.py                          434    366    16%   29, 38-43, 56-78, 82-88, 95-122, 138-165, 168-175, 179-185, 188-201, 209-282, 290-321, 324-338, 341-350, 376-410, 429-457, 465-481, 489-501, 507-512, 518-523, 529-534, 540-545, 551-556, 562-567, 574-579, 585-590, 605-618, 625-630, 639-646, 663-675, 681-686, 692-697, 714-727, 735-740, 746-755, 771-787, 795-800, 806-813, 830-849, 865-882, 890-895, 901-908, 914-919, 925-930, 937-942, 948-953, 961-964, 970, 975-1019, 1030-1032
app/kite/run_kitesession.py                  16     16     0%   2-37
app/kite/secure_token_storage.py             72     20    72%   66-68, 72-73, 121-125, 162-170, 187-193, 205
app/kite/session.py                         100    100     0%   1-179
app/kite/token_bootstrap.py                  93     93     0%   2-136
app/kite/websocket_pool.py                  374    332    11%   40, 66, 70, 94-132, 136-141, 149-357, 361-375, 394-435, 439-523, 530-669, 675-731, 735-767, 772-861, 865-908, 913-928
app/kite_failover.py                         51     51     0%   13-201
app/kite_rate_limiter.py                    230    187    19%   88-92, 104-120, 133-149, 163-166, 175-188, 200-220, 224-226, 239-271, 290-389, 394-428, 437-439, 443-473, 477-480, 484-486, 496-498
app/main.py                                 446    292    35%   28-29, 101-410, 420-446, 494, 513-514, 574, 587-591, 622, 632, 643-645, 654, 660-664, 668-671, 682, 699-704, 733, 736, 739-744, 750-788, 801-850, 865-879
app/metrics.py                               34     34     0%   11-206
app/metrics/__init__.py                       2      0   100%
app/metrics/kite_limits.py                   36     12    67%   153-165, 184-186, 204, 221, 240-241, 259-264
app/metrics/service_health.py                75     75     0%   13-366
app/metrics/tick_metrics.py                  42      0   100%
app/middleware.py                            42      8    81%   115, 127-147
app/order_executor.py                       265    128    52%   32, 121-124, 132-135, 146-147, 189-190, 259-329, 341-398, 402-404, 408-410, 414-416, 420-422, 441-486, 490-496, 506-509, 515
app/publisher.py                             19      9    53%   16-20, 24-27
app/redis_client.py                          82     44    46%   40, 43, 72-73, 79-89, 103-107, 111-140, 143-159
app/redis_publisher_v2.py                   235    235     0%   11-409
app/routes_account.py                        49     38    22%   43-70, 78-87, 104-119
app/routes_advanced.py                      264    189    28%   30-38, 69-127, 172-244, 257-259, 275-280, 343-388, 407, 436-443, 467-474, 499-512, 556-559, 569-574, 604-618, 641-647, 663-686, 706-709, 728-730, 765-795, 820-857
app/routes_gtt.py                            77     59    23%   22-40, 48-57, 65-74, 84-103, 113-123, 133-146
app/routes_mf.py                            110     86    22%   29-45, 55-65, 76-85, 96-114, 124-141, 151-161, 172-181, 190-199, 207-216
app/routes_orders.py                        191    159    17%   27, 54-108, 116-159, 167-198, 206-238, 246-255, 263-272, 280-289, 297-306, 314-324, 332-342, 352-358, 368-382
app/routes_portfolio.py                      40     28    30%   20-29, 39-48, 56-74
app/routes_sync.py                           42     19    55%   22, 27-32, 63-79, 92-119, 132
app/routes_trading_accounts.py              104     82    21%   49-80, 97-108, 125-138, 160-190, 213-240, 267-296, 306-321
app/routes_websocket.py                     175    139    21%   56-64, 72-82, 89-108, 119-139, 147-172, 176-185, 210-260, 266-267, 273-279, 316-418, 428
app/runtime_state.py                         34      4    88%   58, 81-83
app/schema.py                                49      4    92%   23, 93-95
app/services/__init__.py                      7      0   100%
app/services/historical_bootstrapper.py      37     19    49%   61-103
app/services/mock_generator.py              295     54    82%   167, 176-178, 182-183, 188-189, 197, 223, 275, 289, 322-324, 337-346, 350-392, 436-437, 457, 521
app/services/subscription_reconciler.py      88     55    38%   58-59, 67-68, 72-73, 86-142, 167-176, 187-190, 194-197
app/services/tick_batcher.py                146     30    79%   116-119, 129, 156-158, 177-186, 217-218, 229-230, 233-234, 244, 254-260, 270-271
app/services/tick_processor.py              116     49    58%   64, 68, 96, 103-104, 111-114, 135-167, 184-185, 237-238, 272-301, 354-358, 362-363, 367
app/services/tick_validator.py              156     12    92%   68, 84, 158-167, 208, 221
app/services/token_refresher.py             145    105    28%   56-58, 71-79, 86-97, 102-138, 142-150, 164-207, 219-266, 286-312
app/strike_rebalancer.py                    163    163     0%   8-337
app/subscription_store.py                   119     65    45%   36, 39, 48-49, 52-56, 68-107, 115-130, 133-151, 160-161, 165-201, 205, 207-228, 243-245
app/task_persistence.py                      58     58     0%   6-183
app/trade_sync.py                           206    175    15%   53-59, 63-70, 74-89, 93-120, 124-158, 162-210, 226-280, 288-396, 405-456, 460-468, 472-491
app/user_service_client.py                   29     23    21%   16-40
app/utils/__init__.py                         0      0   100%
app/utils/circuit_breaker.py                 72      1    99%   114
app/utils/subscription_reloader.py           67      8    88%   88-89, 154-159
app/utils/symbol_utils.py                    19      4    79%   53, 68, 128-132
app/utils/task_monitor.py                    37      6    84%   44-48, 89-90
app/webhooks.py                              53     26    51%   38-39, 43-47, 51-68, 72-86, 90-92, 96
app/websocket_orders.py                      96     72    25%   38-61, 69-79, 83-84, 88-121, 125-153, 157, 164-166
-----------------------------------------------------------------------
TOTAL                                      8233   5450    34%
Coverage HTML written to dir htmlcov

FAIL Required test coverage of 70% not reached. Total coverage: 33.80%
=========================== short test summary info ============================
FAILED tests/integration/test_api_endpoints.py::test_subscriptions_list - psy...
FAILED tests/integration/test_api_endpoints.py::test_subscriptions_pagination
FAILED tests/integration/test_tick_batcher.py::test_option_batching - assert ...
FAILED tests/integration/test_tick_batcher.py::test_mixed_underlying_and_options
FAILED tests/integration/test_tick_processor.py::test_underlying_tick_processing
FAILED tests/integration/test_tick_processor.py::test_option_tick_processing
FAILED tests/integration/test_tick_processor.py::test_market_depth_extraction
FAILED tests/integration/test_tick_processor.py::test_tick_processor_state_management
FAILED tests/integration/test_tick_processor.py::test_tick_processor_stats - ...
FAILED tests/integration/test_websocket_basic.py::test_websocket_connection_established
FAILED tests/integration/test_websocket_basic.py::test_websocket_graceful_disconnect
FAILED tests/integration/test_websocket_basic.py::test_multiple_connections_isolated
FAILED tests/integration/test_websocket_basic.py::test_subscribe_to_instruments
FAILED tests/integration/test_websocket_basic.py::test_subscribe_idempotent
FAILED tests/integration/test_websocket_basic.py::test_unsubscribe_from_instruments
FAILED tests/integration/test_websocket_basic.py::test_subscription_filtering
FAILED tests/integration/test_websocket_basic.py::test_connection_cleanup_removes_all_subscriptions
FAILED tests/integration/test_websocket_basic.py::test_multiple_subscribers_same_token
FAILED tests/integration/test_websocket_basic.py::test_partial_disconnect_preserves_other_subscribers
FAILED tests/unit/test_order_executor.py::test_circuit_breaker_recovers_to_closed
FAILED tests/unit/test_order_executor.py::test_task_cleanup_on_max_capacity
FAILED tests/unit/test_order_executor.py::test_idempotency_prevents_duplicate_submission
FAILED tests/unit/test_order_executor.py::test_concurrent_task_submission - T...
FAILED tests/unit/test_order_executor.py::test_get_task_status - TypeError: u...
FAILED tests/unit/test_order_executor.py::test_list_tasks - AssertionError: a...
FAILED tests/unit/test_order_executor_simple.py::test_get_all_tasks_returns_list
FAILED tests/unit/test_order_executor_simple.py::test_get_all_tasks_with_status_filter
FAILED tests/unit/test_order_executor_simple.py::test_generate_idempotency_key_different_for_different_symbols
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_place_order_success - ...
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_place_order_network_error_retry
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_place_order_max_retries_exceeded
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_modify_order_idempotency
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_cancel_order_success
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_circuit_breaker_opens_after_failures
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_circuit_breaker_rejects_when_open
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_circuit_breaker_half_open_recovery
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_circuit_breaker_reopen_on_half_open_failure
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_circuit_breaker_manual_reset
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_concurrent_task_execution
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_task_status_transitions
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_exponential_backoff - ...
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_dead_letter_queue_handling
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_task_persistence - Typ...
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_invalid_operation_raises_error
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_missing_params_raises_error
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_task_timeout - TypeErr...
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_executor_cleanup - Typ...
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_executor_stats - TypeE...
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_kite_api_input_exception_no_retry
ERROR tests/unit/test_order_executor_TEMPLATE.py::test_order_already_placed_idempotency
= 28 failed, 176 passed, 26 skipped, 21 warnings, 22 errors in 112.52s (0:01:52) =
